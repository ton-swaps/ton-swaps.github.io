(function(e){function t(t){for(var n,i,o=t[0],u=t[1],c=t[2],p=0,l=[];p<o.length;p++)i=o[p],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&l.push(a[i][0]),a[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);d&&d(t);while(l.length)l.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,o=1;o<r.length;o++){var u=r[o];0!==a[u]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},s=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=u;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("85ec"),a=r.n(n);a.a},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},16:function(e,t){},17:function(e,t){},18:function(e,t){},19:function(e,t){},2:function(e,t){},20:function(e,t){},21:function(e,t){},22:function(e,t){},23:function(e,t){},24:function(e,t){},25:function(e,t){},26:function(e,t){},27:function(e,t){},28:function(e,t){},29:function(e,t){},"29bb":function(e,t,r){r("a15b"),r("d3b7"),r("ac1f"),r("25f0"),r("5319"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("ddb0"),r("9577");var n=r("c973"),a=r("970b"),s=r("5bc3"),i=r("d185"),o=i.TONClient,u=i.setWasmOptions,c=r("e267"),d=r("6993"),p=r("a210"),l=p.BigInteger,h=r("dec0"),f=r("6ecb"),m=r("719a");function w(e){console.log(e)}for(var b=[],g={},v=0;v<=255;v++){var y=v.toString(16);y.length<2&&(y="0"+y),b.push(y),g[y]=v}var k=function(){"use strict";function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["net.ton.dev"];a(this,e),this.inited=!1,this.network=r,this.smcAddress=t,this.abi=c,this.swappers={ETH:f,USDT:m},this.swappers.ETH.ethEnabled(),this.translate={"TON CRYSTAL":"Free TON",ETH:"Ethereum",USDT:"Ethereum",BTC:"Bitcoin"},this.TRANSACTION_VALUE=1e9,this.SWAP_DIRECT_TON_ETH=0,this.SWAP_DIRECT_TON_USDT=1,this.SWAP_DIRECT_TON_BTC=2,this.directTable={0:["TON CRYSTAL","ETH"],1:["TON CRYSTAL","USDT"],2:["TON CRYSTAL","BTC"],ETH:0,USDT:1,BTC:2},this.SWAP_REVERSED_ETH_TON=0,this.SWAP_REVERSED_USDT_TON=1,this.SWAP_REVERSED_BTC_TON=2,this.reversedTable={0:["ETH","TON CRYSTAL"],1:["USDT","TON CRYSTAL"],2:["BTC","TON CRYSTAL"],ETH:0,USDT:1,BTC:2},this.BigInteger=l}return s(e,[{key:"init",value:function(){var e=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u({debug:w}),e.next=3,o.create({servers:this.network});case 3:this.client=e.sent,this.ordersWatcher=new h(this.client,this),this.inited=!0;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isInited",value:function(){return this.inited}},{key:"getAddress",value:function(){return this.smcAddress}},{key:"translateToken",value:function(e){return this.translate[e]}},{key:"bytesToHex",value:function(e){for(var t=[],r=0;r<e.byteLength;r++)t.push(b[e[r]]);return t.join("")}},{key:"bytesToHexString",value:function(e){for(var t=[],r=0;r<e.byteLength;r++)t.push("\\x"+b[e[r]]);return t.join("")}},{key:"hexToBytes",value:function(e){e=e.toLowerCase();var t=e.length;if(t%2!==0)throw Error("hex string must have length a multiple of 2");for(var r=t/2,n=new Uint8Array(r),a=0;a<r;a++){var s=2*a,i=e.substring(s,s+2);n[a]=g[i]}return n}},{key:"hexAlign",value:function(e,t){e=e.replace("0x","");for(var r=t-e.length;r>0;r--)e="0"+e;return e}},{key:"sha256",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("undefined"===typeof window){e.next=7;break}return"string"===typeof t&&(t=this.hexToBytes(t.replace("0x",""))),e.next=4,crypto.subtle.digest("SHA-256",t);case 4:return r=e.sent,console.log("hash",r),e.abrupt("return","0x"+this.bytesToHex(new Uint8Array(r)));case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"generateSecret",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.client.crypto.ed25519Keypair();case 2:return t=e.sent,e.abrupt("return",this.hexToBytes(t.secret));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"_createInternalMessage",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},console.log("_createInternalMessage"),console.log("abi",this.abi),console.log("functionName",t),console.log("input",r),e.next=7,this.client.contracts.createRunBody({abi:this.abi,function:t,header:void 0,params:r,internal:!0,keyPair:void 0,signingBox:void 0});case 7:return n=e.sent,console.log("output",n),e.abrupt("return",n.bodyBase64);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"_runSmcMethod",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n,a,s,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=i.length>2&&void 0!==i[2]?i[2]:{},console.log("_runSmcMethod"),console.log("value",t),console.log("functionName",r),console.log("input",n),this.wallet){e.next=7;break}throw Error("Not logged");case 7:return e.next=9,this._createInternalMessage(r,n);case 9:return a=e.sent,e.next=12,this.wallet.transact(t,this.getAddress(),a);case 12:return s=e.sent,console.log("output",s),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"_runGetMethod",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},console.log("_runGetMethod"),console.log("functionName",t),console.log("input",r),e.next=6,this.client.contracts.runLocal({address:this.smcAddress,abi:this.abi,functionName:t,fullRun:!1,input:r});case 6:return n=e.sent,console.log("output",n),e.abrupt("return",n.output);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getAltValue",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getAltValue:",t,r),e.prev=1,e.next=4,this._runGetMethod("calcForeignOutput",{value:t,exchangeRate:r});case 4:return n=e.sent,e.abrupt("return",n.foreignValue);case 8:e.prev=8,e.t0=e["catch"](1),console.log("getAltValue error:",e.t0);case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"login",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new d(this.client),e.next=3,n.login(t,r);case 3:this.wallet=n;case 4:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"logout",value:function(){this.wallet=void 0}},{key:"deposit",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.wallet){e.next=2;break}throw Error("Not logged");case 2:if(r===this.wallet.seed){e.next=4;break}throw Error("Invalid seed phrase");case 4:return t=l(t),t=t.add(this.TRANSACTION_VALUE),e.next=8,this.wallet.transact("0x"+t.toString(16),this.getAddress());case 8:return n=e.sent,console.log("deposit",n),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"withdraw",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.wallet){e.next=2;break}throw Error("Not logged");case 2:if(r===this.wallet.seed){e.next=4;break}throw Error("Invalid seed phrase");case 4:return t=l(t),e.next=7,this._runSmcMethod(this.TRANSACTION_VALUE,"withdraw",{amount:"0x"+t.toString(16)});case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"updateInfo",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.wallet){e.next=2;break}throw Error("Not logged");case 2:return e.next=4,this._runGetMethod("getBalance",{participant:this.wallet.getAddress()});case 4:return t=e.sent,r={freeFunds:t.balance.value,ordersFunds:t.balance.inOrders,lockedFunds:t.balance.locked},e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDirectOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._runGetMethod("getDirectOrder",{dbId:t,initiatorAddress:r});case 2:if(n=e.sent,"0x0"!==n.order.value){e.next=5;break}return e.abrupt("return",void 0);case 5:return n.order.id=r,n.order.swapId=t,n.order.direct=!0,n.order.fromToken=this.directTable[t][0],n.order.toToken=this.directTable[t][1],n.order.secretHash="0x"+this.hexAlign(n.order.secretHash,64),e.abrupt("return",n.order);case 12:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getReversedOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._runGetMethod("getReversedOrder",{dbId:t,initiatorAddress:r});case 2:if(n=e.sent,"0x0"!==n.order.foreignValue){e.next=5;break}return e.abrupt("return",void 0);case 5:return n.order.id=r,n.order.swapId=t,n.order.direct=!1,n.order.fromToken=this.reversedTable[t][0],n.order.toToken=this.reversedTable[t][1],n.order.secretHash="0x"+this.hexAlign(n.order.secretHash,64),e.abrupt("return",n.order);case 12:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getDirectOrders",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._runGetMethod("getDirectOrders",{dbId:t});case 2:r=e.sent,n=[],e.t0=regeneratorRuntime.keys(r.orders);case 5:if((e.t1=e.t0()).done){e.next=13;break}return a=e.t1.value,e.next=9,this.getDirectOrder(t,r.orders[a]);case 9:s=e.sent,s&&n.push(s),e.next=5;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getReversedOrders",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._runGetMethod("getReversedOrders",{dbId:t});case 2:r=e.sent,n=[],e.t0=regeneratorRuntime.keys(r.orders);case 5:if((e.t1=e.t0()).done){e.next=13;break}return a=e.t1.value,e.next=9,this.getReversedOrder(t,r.orders[a]);case 9:s=e.sent,s&&n.push(s),e.next=5;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getMyOrders",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.wallet){e.next=2;break}throw Error("Not logged");case 2:return t=[],e.next=5,this.getDirectOrder(this.SWAP_DIRECT_TON_USDT,this.wallet.getAddress());case 5:return r=e.sent,r&&t.push(r),e.next=9,this.getDirectOrder(this.SWAP_DIRECT_TON_ETH,this.wallet.getAddress());case 9:return r=e.sent,r&&t.push(r),e.next=13,this.getDirectOrder(this.SWAP_DIRECT_TON_BTC,this.wallet.getAddress());case 13:return r=e.sent,r&&t.push(r),e.next=17,this.getReversedOrder(this.SWAP_REVERSED_USDT_TON,this.wallet.getAddress());case 17:return r=e.sent,r&&t.push(r),e.next=21,this.getReversedOrder(this.SWAP_REVERSED_ETH_TON,this.wallet.getAddress());case 21:return r=e.sent,r&&t.push(r),e.next=25,this.getReversedOrder(this.SWAP_REVERSED_BTC_TON,this.wallet.getAddress());case 25:return r=e.sent,r&&t.push(r),e.abrupt("return",t);case 28:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"createOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r,n,a,s,i,o,u,c){var d,p,h,f,m,w,b,g,v,y,k,x=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(d=!(x.length>9&&void 0!==x[9])||x[9],console.log("createOrder",n,a,s,i,o,c),p="TON CRYSTAL"===t,h=p?this.directTable[r]:this.reversedTable[t],!d){e.next=16;break}if(!p){e.next=11;break}return e.next=8,this.getDirectOrder(h,this.wallet.getAddress());case 8:f=e.sent,e.next=14;break;case 11:return e.next=13,this.getReversedOrder(h,this.wallet.getAddress());case 13:f=e.sent;case 14:if(!f){e.next=16;break}throw Error("Order already exists");case 16:if(this.wallet){e.next=18;break}throw Error("Not logged");case 18:if(c===this.wallet.seed){e.next=20;break}throw Error("Invalid seed phrase");case 20:if(!p){e.next=35;break}return m=l(a),w=l(s),b=l(n),e.t0=this,e.next=27,this.sha256(u);case 27:return e.t1=e.sent,e.t2=e.t0.hexAlign.call(e.t0,e.t1,64),g="0x"+e.t2,e.next=32,this._runSmcMethod(this.TRANSACTION_VALUE,"createDirectOrder",{dbId:h,value:"0x"+m.toString(16),minValue:"0x"+w.toString(16),exchangeRate:"0x"+b.toString(16),timeLockSlot:i,secretHash:g,initiatorTargetAddress:o});case 32:return e.abrupt("return",e.sent);case 35:return v=l(a),y=l(s),k=l(n),e.next=40,this._runSmcMethod(this.TRANSACTION_VALUE,"createReversedOrder",{dbId:h,value:"0x"+v.toString(16),minValue:"0x"+y.toString(16),exchangeRate:"0x"+k.toString(16),timeLockSlot:i,initiatorSourceAddress:o});case 40:return e.abrupt("return",e.sent);case 41:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,s,i,o,u,c){return e.apply(this,arguments)}return t}()},{key:"confirmOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r,n,a,s){var i,o,u,c,d=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!(d.length>5&&void 0!==d[5])||d[5],console.log("confirmOrder",t,r,n,s),!i){e.next=16;break}if(!t.direct){e.next=9;break}return e.next=6,this.getDirectOrder(t.swapId,t.id);case 6:t=e.sent,e.next=12;break;case 9:return e.next=11,this.getReversedOrder(t.swapId,t.id);case 11:t=e.sent;case 12:if(t){e.next=14;break}throw Error("Order already closed");case 14:if(!t.confirmed){e.next=16;break}throw Error("Order already confirmed");case 16:if(this.wallet){e.next=18;break}throw Error("Not logged");case 18:if(s===this.wallet.seed){e.next=20;break}throw Error("Invalid seed phrase");case 20:if(!t.direct){e.next=27;break}return o=l(r),e.next=24,this._runSmcMethod(this.TRANSACTION_VALUE,"confirmDirectOrder",{dbId:t.swapId,value:"0x"+o.toString(16),initiatorAddress:t.id,confirmatorSourceAddress:n});case 24:return e.abrupt("return",e.sent);case 27:return u=l(r),e.t0=this,e.next=31,this.sha256(a);case 31:return e.t1=e.sent,e.t2=e.t0.hexAlign.call(e.t0,e.t1,64),c="0x"+e.t2,e.next=36,this._runSmcMethod(this.TRANSACTION_VALUE,"confirmReversedOrder",{dbId:t.swapId,value:"0x"+u.toString(16),initiatorAddress:t.id,confirmatorTargetAddress:n,secretHash:c});case 36:return e.abrupt("return",e.sent);case 37:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,s){return e.apply(this,arguments)}return t}()},{key:"closeOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=!(a.length>2&&void 0!==a[2])||a[2],!n){e.next=15;break}if(!t.direct){e.next=8;break}return e.next=5,this.getDirectOrder(t.swapId,t.id);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,this.getReversedOrder(t.swapId,t.id);case 10:t=e.sent;case 11:if(t){e.next=13;break}throw Error("Order already closed");case 13:if(!t.confirmed){e.next=15;break}throw Error("Order already confirmed");case 15:if(this.wallet){e.next=17;break}throw Error("Not logged");case 17:if(r===this.wallet.seed){e.next=19;break}throw Error("Invalid seed phrase");case 19:if(t.id===this.wallet.getAddress()){e.next=21;break}throw Error("Cannot close another's order");case 21:if(!t.direct){e.next=27;break}return e.next=24,this._runSmcMethod(this.TRANSACTION_VALUE,"deleteDirectOrder",{dbId:t.swapId});case 24:return e.abrupt("return",e.sent);case 27:return e.next=29,this._runSmcMethod(this.TRANSACTION_VALUE,"deleteReversedOrder",{dbId:t.swapId});case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"finishOrderWithSecret",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r,n){var a,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=!(s.length>3&&void 0!==s[3])||s[3],r="string"!==typeof r?this.bytesToHex(r):r.replace("0x",""),r=this.hexAlign(r,64),!a){e.next=17;break}if(!t.direct){e.next=10;break}return e.next=7,this.getDirectOrder(t.swapId,t.id);case 7:t=e.sent,e.next=13;break;case 10:return e.next=12,this.getReversedOrder(t.swapId,t.id);case 12:t=e.sent;case 13:if(t){e.next=15;break}throw Error("Order already closed");case 15:if(t.confirmed){e.next=17;break}throw Error("Order not confirmed");case 17:if(this.wallet){e.next=19;break}throw Error("Not logged");case 19:if(n===this.wallet.seed){e.next=21;break}throw Error("Invalid seed phrase");case 21:if(!t.direct){e.next=27;break}return e.next=24,this._runSmcMethod(this.TRANSACTION_VALUE,"finishDirectOrderWithSecret",{dbId:t.swapId,initiatorAddress:t.id,secret:r});case 24:return e.abrupt("return",e.sent);case 27:return e.next=29,this._runSmcMethod(this.TRANSACTION_VALUE,"finishReversedOrderWithSecret",{dbId:t.swapId,initiatorAddress:t.id,secret:r});case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()},{key:"finishOrderWithTimeout",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=!(a.length>2&&void 0!==a[2])||a[2],!n){e.next=15;break}if(!t.direct){e.next=8;break}return e.next=5,this.getDirectOrder(t.swapId,t.id);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,this.getReversedOrder(t.swapId,t.id);case 10:t=e.sent;case 11:if(t){e.next=13;break}throw Error("Order already closed");case 13:if(t.confirmed){e.next=15;break}throw Error("Order not confirmed");case 15:if(this.wallet){e.next=17;break}throw Error("Not logged");case 17:if(r===this.wallet.seed){e.next=19;break}throw Error("Invalid seed phrase");case 19:if(!t.direct){e.next=25;break}return e.next=22,this._runSmcMethod(this.TRANSACTION_VALUE,"finishDirectOrderWithTimeout",{dbId:t.swapId,initiatorAddress:t.id});case 22:return e.abrupt("return",e.sent);case 25:return e.next=27,this._runSmcMethod(this.TRANSACTION_VALUE,"finishReversedOrderWithTimeout",{dbId:t.swapId,initiatorAddress:t.id});case 27:return e.abrupt("return",e.sent);case 28:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getOrders",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n="TON CRYSTAL"===t,a=n?this.directTable[r]:this.reversedTable[t],!n){e.next=8;break}return e.next=5,this.getDirectOrders(a);case 5:return e.abrupt("return",e.sent);case 8:return e.next=10,this.getReversedOrders(a);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,2e3)}));case 2:return e.abrupt("return",this.order);case 3:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}()}]),e}();e.exports=k},"2f54":function(e,t){var r={"ABI version":2,header:["pubkey","time","expire"],functions:[{name:"constructor",inputs:[{name:"owners",type:"uint256[]"},{name:"reqConfirms",type:"uint8"}],outputs:[]},{name:"acceptTransfer",inputs:[{name:"payload",type:"bytes"}],outputs:[]},{name:"sendTransaction",inputs:[{name:"dest",type:"address"},{name:"value",type:"uint128"},{name:"bounce",type:"bool"},{name:"flags",type:"uint8"},{name:"payload",type:"cell"}],outputs:[]},{name:"submitTransaction",inputs:[{name:"dest",type:"address"},{name:"value",type:"uint128"},{name:"bounce",type:"bool"},{name:"allBalance",type:"bool"},{name:"payload",type:"cell"}],outputs:[{name:"transId",type:"uint64"}]},{name:"confirmTransaction",inputs:[{name:"transactionId",type:"uint64"}],outputs:[]},{name:"isConfirmed",inputs:[{name:"mask",type:"uint32"},{name:"index",type:"uint8"}],outputs:[{name:"confirmed",type:"bool"}]},{name:"getParameters",inputs:[],outputs:[{name:"maxQueuedTransactions",type:"uint8"},{name:"maxCustodianCount",type:"uint8"},{name:"expirationTime",type:"uint64"},{name:"minValue",type:"uint128"},{name:"requiredTxnConfirms",type:"uint8"},{name:"requiredUpdConfirms",type:"uint8"}]},{name:"getTransaction",inputs:[{name:"transactionId",type:"uint64"}],outputs:[{components:[{name:"id",type:"uint64"},{name:"confirmationsMask",type:"uint32"},{name:"signsRequired",type:"uint8"},{name:"signsReceived",type:"uint8"},{name:"creator",type:"uint256"},{name:"index",type:"uint8"},{name:"dest",type:"address"},{name:"value",type:"uint128"},{name:"sendFlags",type:"uint16"},{name:"payload",type:"cell"},{name:"bounce",type:"bool"}],name:"trans",type:"tuple"}]},{name:"getTransactions",inputs:[],outputs:[{components:[{name:"id",type:"uint64"},{name:"confirmationsMask",type:"uint32"},{name:"signsRequired",type:"uint8"},{name:"signsReceived",type:"uint8"},{name:"creator",type:"uint256"},{name:"index",type:"uint8"},{name:"dest",type:"address"},{name:"value",type:"uint128"},{name:"sendFlags",type:"uint16"},{name:"payload",type:"cell"},{name:"bounce",type:"bool"}],name:"transactions",type:"tuple[]"}]},{name:"getTransactionIds",inputs:[],outputs:[{name:"ids",type:"uint64[]"}]},{name:"getCustodians",inputs:[],outputs:[{components:[{name:"index",type:"uint8"},{name:"pubkey",type:"uint256"}],name:"custodians",type:"tuple[]"}]},{name:"submitUpdate",inputs:[{name:"codeHash",type:"uint256"},{name:"owners",type:"uint256[]"},{name:"reqConfirms",type:"uint8"}],outputs:[{name:"updateId",type:"uint64"}]},{name:"confirmUpdate",inputs:[{name:"updateId",type:"uint64"}],outputs:[]},{name:"executeUpdate",inputs:[{name:"updateId",type:"uint64"},{name:"code",type:"cell"}],outputs:[]},{name:"getUpdateRequests",inputs:[],outputs:[{components:[{name:"id",type:"uint64"},{name:"index",type:"uint8"},{name:"signs",type:"uint8"},{name:"confirmationsMask",type:"uint32"},{name:"creator",type:"uint256"},{name:"codeHash",type:"uint256"},{name:"custodians",type:"uint256[]"},{name:"reqConfirms",type:"uint8"}],name:"updates",type:"tuple[]"}]}],data:[],events:[{name:"TransferAccepted",inputs:[{name:"payload",type:"bytes"}],outputs:[]}]};e.exports=r},3:function(e,t){},30:function(e,t){},31:function(e,t){},32:function(e,t){},33:function(e,t){},34:function(e,t){},35:function(e,t){},36:function(e,t){},37:function(e,t){},38:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);r("4de4"),r("fb6a"),r("d3b7"),r("ac1f"),r("25f0"),r("5319"),r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=r("5f5b"),s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("b-alert",{attrs:{id:"alert",show:e.alert}},[e._v("Swap operation in progress, please do not close this tab")]),r("b-navbar",{class:[e.isLogged?"":"mb-20"],attrs:{id:"navbar",toggleable:"sm",type:"dark",variant:"primary",sticky:""}},[r("b-navbar-brand",{attrs:{href:"#"}},[e._v("Free TON Atomic Swaps "),r("sup",[e._v("demo")])]),r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),r("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[r("b-navbar-nav",{staticClass:"ml-auto",attrs:{right:""}},[r("b-nav-item",{attrs:{href:"#",active:"eth"===e.tab},on:{click:e.eth}},[e._v("ETH")]),r("b-nav-item",{attrs:{href:"#",active:"usdt"===e.tab},on:{click:e.usdt}},[e._v("USDT")]),r("b-nav-item",{attrs:{href:"#",active:"btc"===e.tab},on:{click:e.btc}},[e._v("BTC")]),e.isLogged?r("b-nav-item",{attrs:{href:"#",active:"orders"===e.tab},on:{click:e.orders}},[e._v("ORDERS")]):e._e(),e.isLogged?e._e():r("b-nav-item",{attrs:{href:"#",active:"login"===e.tab},on:{click:e.login}},[e._v("LOGIN")]),e.isLogged?r("b-nav-item",{attrs:{href:"#"},on:{click:e.logout}},[e._v("LOGOUT")]):e._e()],1)],1)],1),e.isLogged?r("b-navbar",{staticClass:"mb-20",attrs:{id:"navbar",toggleable:"sm",type:"dark",variant:"light",sticky:""}},[r("span",{staticClass:"mr-2"},[e._v(" Free: "+e._s(e._f("formatTonHex")(e.balance.freeFunds))+" ")]),r("span",{staticClass:" ml-2 mr-2"},[e._v(" In Orders: "+e._s(e._f("formatTonHex")(e.balance.ordersFunds))+" ")]),r("span",{staticClass:" ml-2 mr-2"},[e._v(" Locked: "+e._s(e._f("formatTonHex")(e.balance.lockedFunds))+" ")]),r("b-navbar-nav",{staticClass:"ml-auto",attrs:{right:""}},[r("b-button",{staticClass:"ml-2",attrs:{href:"#",variant:"primary",left:""},on:{click:e.deposit}},[e._v("Deposit")]),r("b-button",{staticClass:"ml-2",attrs:{href:"#",variant:"primary",left:"",disabled:"0x0"===e.balance.freeFunds},on:{click:e.withdraw}},[e._v("Withdraw")])],1)],1):e._e(),r("span",{staticClass:"border"}),"login"===e.tab?r("Login",{on:{logged:e.logged}}):e._e(),"withdraw"===e.tab?r("Withdraw",{attrs:{address:e.address,maxAmount:e.balance.freeFunds},on:{withdrawn:e.withdrawn}}):e._e(),"deposit"===e.tab?r("Deposit",{attrs:{address:e.address,depositAddress:e.depositAddress},on:{deposited:e.deposited}}):e._e(),"newOrder"===e.tab?r("NewOrder",{attrs:{address:e.address,maxTonAmount:e.balance.freeFunds,order:e.newOrder},on:{orderCreated:e.orderCreated}}):e._e(),"confirmOrder"===e.tab?r("ConfirmOrder",{attrs:{address:e.address,maxTonAmount:e.balance.freeFunds,order:e.newOrderConfirm},on:{orderConfirmed:e.orderConfirmed}}):e._e(),"eth"===e.tab||"usdt"===e.tab||"btc"===e.tab?r("OrderList",{attrs:{logged:e.isLogged,token:e.orderList.token},on:{createOrder:e.createOrder,confirmOrder:e.confirmOrder}}):e._e(),"orders"===e.tab?r("MyOrders",{attrs:{address:e.address}}):e._e()],1)},i=[],o=(r("96cf"),r("1da1")),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",[r("b-col",{attrs:{sm:"8",offset:"2"}},[r("b-card",{attrs:{"border-variant":"primary",header:"Login","header-bg-variant":"primary","header-text-variant":"white",align:"center"}},[r("b-alert",{attrs:{variant:"danger",show:e.alert}},[e._v(e._s(e.alertMsg))]),r("b-form",{on:{submit:e.login}},[r("b-form-group",{attrs:{id:"input-group-1",label:"Your Free TON address:","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",required:"",placeholder:"Enter Free TON address"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Your Seed phrase:","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",required:"",placeholder:"Enter Seed phrase"},model:{value:e.form.seed,callback:function(t){e.$set(e.form,"seed",t)},expression:"form.seed"}})],1),r("b-button",{attrs:{variant:"primary",disabled:e.loginInProgress,type:"submit"}},[e.loginInProgress?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v(" Login")])],1)],1)],1)],1)],1)},c=[],d={data:function(){return{form:{address:"",seed:""},loginInProgress:!1,alert:!1,alertMsg:""}},methods:{login:function(e){var t=this;e.preventDefault(),this.loginInProgress=!0;var r=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$swapOrderbook.login(t.form.address,t.form.seed);case 3:return e.next=5,t.$swapOrderbook.updateInfo();case 5:r=e.sent,t.loginInProgress=!1,t.$emit("logged",r,t.form.address,t.form.seed),e.next=20;break;case 10:return e.prev=10,e.t0=e["catch"](0),console.log("error",e.t0),t.alertMsg="Failed to login: "+e.t0.message.toString(),t.alert=!0,e.next=17,new Promise((function(e){return setTimeout(e,3e3)}));case 17:t.alert=!1,t.alertMsg="",t.loginInProgress=!1;case 20:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();r()}}},p=d,l=r("2877"),h=Object(l["a"])(p,u,c,!1,null,"45b09312",null),f=h.exports,m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",[r("b-col",{attrs:{sm:"8",offset:"2"}},[r("b-card",{attrs:{"border-variant":"primary",header:"Withdraw","header-bg-variant":"primary","header-text-variant":"white",align:"center"}},[r("b-alert",{attrs:{variant:"danger",show:e.alert}},[e._v(e._s(e.alertMsg))]),r("b-form",{on:{submit:e.withdraw}},[r("b-form-group",{attrs:{id:"input-group-1",label:"Your Free TON address:","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",required:"",readonly:""},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1),r("b-form-group",{attrs:{id:"input-group-3",label:"Amount:","label-for":"input-3"}},[r("b-form-input",{attrs:{id:"input-3",max:e.maxAmount,min:"0.000000001",step:"0.000000001",type:"number",required:"",placeholder:"Token amount"},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Your Seed phrase:","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",required:"",placeholder:"Enter Seed phrase"},model:{value:e.form.seed,callback:function(t){e.$set(e.form,"seed",t)},expression:"form.seed"}})],1),r("b-button",{attrs:{variant:"primary",disabled:e.withdrawInProgress,type:"submit"}},[e.withdrawInProgress?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v(" Withdraw ")])],1)],1)],1)],1)],1)},w=[],b={props:["maxAmount","address"],data:function(){return{form:{seed:"",amount:0},withdrawInProgress:!1,alert:!1,alertMsg:""}},methods:{withdraw:function(e){var t=this;e.preventDefault(),this.withdrawInProgress=!0;var r=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$swapOrderbook.withdraw(1e9*t.form.amount,t.form.seed);case 3:return e.next=5,t.$swapOrderbook.updateInfo();case 5:return r=e.sent,t.withdrawInProgress=!1,t.$emit("withdrawn",r),e.abrupt("return");case 11:return e.prev=11,e.t0=e["catch"](0),console.log("withdraw error",e.t0),t.alertMsg="Failed to withdraw: "+e.t0.message.toString(),t.alert=!0,e.next=18,new Promise((function(e){return setTimeout(e,3e3)}));case 18:t.alert=!1,t.alertMsg="",t.withdrawInProgress=!1;case 21:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();r()}}},g=b,v=Object(l["a"])(g,m,w,!1,null,"2fbf9f6c",null),y=v.exports,k=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",[r("b-col",{attrs:{sm:"8",offset:"2"}},[r("b-card",{attrs:{"border-variant":"primary",header:"Deposit (1 TON CRYSTAL of fee will be charged)","header-bg-variant":"primary","header-text-variant":"white",align:"center"}},[r("b-alert",{attrs:{variant:"danger",show:e.alert}},[e._v(e._s(e.alertMsg))]),r("b-form",{on:{submit:e.deposit}},[r("b-form-group",{attrs:{id:"input-group-3",label:"Amount:","label-for":"input-3"}},[r("b-form-input",{attrs:{id:"input-3",min:"0.000000001",step:"0.000000001",type:"number",required:"",placeholder:"Token amount"},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Your Seed phrase:","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",required:"",placeholder:"Enter Seed phrase"},model:{value:e.form.seed,callback:function(t){e.$set(e.form,"seed",t)},expression:"form.seed"}})],1),r("b-button",{attrs:{variant:"primary",type:"submit",disabled:e.depositInProgress}},[e.depositInProgress?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v(" Deposit ")])],1)],1)],1)],1)],1)},x=[],T={props:["depositAddress","address"],data:function(){return{depositInProgress:!1,alert:!1,alertMsg:"",form:{seed:"",amount:0}}},methods:{deposit:function(e){var t=this;e.preventDefault(),this.depositInProgress=!0;var r=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$swapOrderbook.deposit(1e9*t.form.amount,t.form.seed);case 3:return e.next=5,t.$swapOrderbook.updateInfo();case 5:return r=e.sent,t.depositInProgress=!1,t.$emit("deposited",r),e.abrupt("return");case 11:return e.prev=11,e.t0=e["catch"](0),console.log("deposit error",e.t0),t.alertMsg="Failed to deposit: "+e.t0.message.toString(),t.alert=!0,e.next=18,new Promise((function(e){return setTimeout(e,3e3)}));case 18:t.alert=!1,t.alertMsg="",t.depositInProgress=!1;case 21:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();r()}}},A=T,R=Object(l["a"])(A,k,x,!1,null,"365a535c",null),S=R.exports,O=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",[r("b-col",{attrs:{sm:"10",offset:"1"}},[r("b-card",{attrs:{"border-variant":"primary",header:"Create new order","header-bg-variant":"primary","header-text-variant":"white",align:"center",title:e.order.fromToken+" to "+e.order.toToken}},[r("b-alert",{attrs:{variant:"danger",show:e.alert}},[e._v(e._s(e.alertMsg))]),r("b-form",{on:{submit:e.createOrder}},[r("b-form-group",{attrs:{id:"input-group-1",label:"Amount ("+e.order.fromToken+"):","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",max:e.maxAmount(),min:e.amountStep(),step:e.amountStep(),type:"number",required:"",placeholder:"Token amount"},model:{value:e.amount,callback:function(t){e.amount=t},expression:"amount"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Exchange rate (price of 1 TON CRYSTAL):","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",min:"0.000000001",step:"0.000000001",type:"number",required:"",placeholder:"Price in "+e.order.altToken+" for 1 TON CRYSTAL"},model:{value:e.form.rate,callback:function(t){e.$set(e.form,"rate",t)},expression:"form.rate"}})],1),r("b-form-group",{attrs:{id:"input-group-3",label:"You will receive ("+e.order.toToken+"):","label-for":"input-3"}},[r("b-form-input",{attrs:{id:"input-3",readonly:""},model:{value:e.targetAmount,callback:function(t){e.targetAmount=t},expression:"targetAmount"}})],1),r("b-form-group",{attrs:{id:"input-group-4",label:"TON CRYSTAL"===e.order.fromToken?"Your "+e.targetCurrency+" target address:":"Your "+e.sourceCurrency+" source address:","label-for":"input-4"}},[r("b-form-input",{attrs:{id:"input-4",required:""},model:{value:e.form.initiatorAltAddress,callback:function(t){e.$set(e.form,"initiatorAltAddress",t)},expression:"form.initiatorAltAddress"}})],1),r("b-form-group",{attrs:{id:"input-group-5",label:"Timelock slot (funds will be blocked for a max of "+e.maxLock+" hours):","label-for":"input-5"}},[r("b-form-select",{attrs:{id:"input-5",options:e.timeSlots,required:""},model:{value:e.form.timeSlot,callback:function(t){e.$set(e.form,"timeSlot",t)},expression:"form.timeSlot"}})],1),r("b-form-group",{attrs:{id:"input-group-6",label:"Minimum Amount ("+e.order.fromToken+"):","label-for":"input-6"}},[r("b-form-input",{attrs:{id:"input-6",max:Math.min(e.maxAmount(),e.amount),min:e.amountStep(),step:e.amountStep(),type:"number",required:"",placeholder:"Token amount"},model:{value:e.form.minAmount,callback:function(t){e.$set(e.form,"minAmount",t)},expression:"form.minAmount"}})],1),r("b-form-group",{attrs:{id:"input-group-7",label:"Your Login Seed phrase:","label-for":"input-7"}},[r("b-form-input",{attrs:{id:"input-7",required:"",placeholder:"Enter Login Seed phrase"},model:{value:e.form.seed,callback:function(t){e.$set(e.form,"seed",t)},expression:"form.seed"}})],1),r("b-button",{attrs:{variant:"primary",disabled:e.createInProgress,type:"submit"}},[e.createInProgress?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v(" Create ")])],1)],1)],1)],1)],1)},_=[],E=(r("a9e3"),{props:["order","address","maxTonAmount"],data:function(){return{amount:0,form:{seed:"",minAmount:0,timeSlot:"4 Hours",initiatorAltAddress:"",rate:1},sourceCurrency:"",targetCurrency:"",timeSlots:["1 Hour","4 Hours","12 Hours","24 Hours","48 Hours"],createInProgress:!1,alert:!1,alertMsg:""}},created:function(){"TON CRYSTAL"===this.order.fromToken?(this.amount=this.maxTonAmount,this.form.minAmount=this.maxTonAmount):(this.amount=0,this.form.minAmount=0),this.sourceCurrency=this.$swapOrderbook.translateToken(this.order.fromToken),this.targetCurrency=this.$swapOrderbook.translateToken(this.order.toToken),console.log("new order created")},mounted:function(){var e=this;"ETH"!==this.order.altToken&&"USDT"!==this.order.altToken||this.$swapOrderbook.swappers.ETH.waitEthAddresses().then((function(t){void 0!==t[0]&&""===e.form.initiatorAltAddress&&(e.form.initiatorAltAddress=t[0])}))},watch:{amount:function(e){this.form.minAmount=Math.min(this.form.minAmount,e)}},computed:{targetAmount:function(){return"TON CRYSTAL"===this.order.fromToken?this.amount*this.form.rate:this.amount/this.form.rate},maxLock:function(){return 3*this.lockTime()}},methods:{lockTime:function(){switch(this.form.timeSlot){case"1 Hour":return 1;case"4 Hours":return 4;case"12 Hours":return 12;case"24 Hours":return 24;case"48 Hours":return 48}},maxAmount:function(){return"TON CRYSTAL"===this.order.fromToken?this.maxTonAmount.toString():Number.MAX_VALUE.toString()},amountStep:function(){return"TON CRYSTAL"===this.order.fromToken?"0.000000001":"BTC"===this.order.fromToken?"0.00000001":"ETH"===this.order.fromToken?"0.000000001":"USDT"===this.order.fromToken?"0.000001":"1"},createOrder:function(e){var t=this;e.preventDefault(),this.createInProgress=!0;var r=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var r,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r="TON CRYSTAL"===t.order.fromToken?t.order.toToken:t.order.fromToken,e.next=4,t.$swapOrderbook.ordersWatcher.newOrder();case 4:return n=e.sent,e.next=7,n.createOrder(t.order.fromToken,t.order.toToken,t.$convertRate(r,t.form.rate),t.$convertValue(t.order.fromToken,t.amount),t.$convertValue(t.order.fromToken,t.form.minAmount),3600*t.lockTime(),t.$convertAltAddress(r,t.form.initiatorAltAddress),t.address,t.form.seed);case 7:return e.next=9,t.$swapOrderbook.updateInfo();case 9:a=e.sent,t.createInProgress=!1,t.$emit("orderCreated",a),e.next=24;break;case 14:return e.prev=14,e.t0=e["catch"](0),console.log("createOrder error",e.t0),t.alertMsg="Failed to create order: "+e.t0.message.toString(),t.alert=!0,e.next=21,new Promise((function(e){return setTimeout(e,3e3)}));case 21:t.alert=!1,t.alertMsg="",t.createInProgress=!1;case 24:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}();r()}}}),C=E,I=Object(l["a"])(C,O,_,!1,null,"55696dd4",null),P=I.exports,H=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",[r("b-col",{attrs:{sm:"10",offset:"1"}},[r("b-card",{attrs:{"border-variant":"primary",header:"Confirm order","header-bg-variant":"primary","header-text-variant":"white",align:"center",title:e.order.fromToken+" to "+e.order.toToken}},[r("b-alert",{attrs:{variant:"danger",show:e.alert}},[e._v(e._s(e.alertMsg))]),r("b-form",{on:{submit:e.confirmOrder}},[r("b-form-group",{attrs:{id:"input-group-1",label:"You want to buy ("+e.order.fromToken+"):","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",max:e.foreignValue,min:e.foreignMinValue,step:e.amountStep(),type:"number",required:"",placeholder:"Token amount"},model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Exchange rate (price of 1 TON CRYSTAL):","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",required:"",readonly:""},model:{value:e.exchangeRate,callback:function(t){e.exchangeRate=t},expression:"exchangeRate"}})],1),r("b-form-group",{attrs:{id:"input-group-3",label:"You will pay ("+e.order.toToken+"):","label-for":"input-3"}},[r("b-form-input",{attrs:{id:"input-3",readonly:""},model:{value:e.targetValue,callback:function(t){e.targetValue=t},expression:"targetValue"}})],1),r("b-form-group",{attrs:{id:"input-group-4",label:e.order.direct?"Your "+e.targetCurrency+" source address:":"Your "+e.sourceCurrency+" target address:","label-for":"input-4"}},[r("b-form-input",{attrs:{id:"input-4",required:""},model:{value:e.form.recipientAltAddress,callback:function(t){e.$set(e.form,"recipientAltAddress",t)},expression:"form.recipientAltAddress"}})],1),r("b-form-group",{attrs:{id:"input-group-5",label:"Timelock slot (funds will be blocked for a max of "+e.maxLock+" hours):","label-for":"input-5"}},[r("b-form-input",{attrs:{id:"input-5",required:"",readonly:""},model:{value:e.lockTime,callback:function(t){e.lockTime=t},expression:"lockTime"}})],1),r("b-form-group",{attrs:{id:"input-group-7",label:"Your Login Seed phrase:","label-for":"input-7"}},[r("b-form-input",{attrs:{id:"input-7",required:"",placeholder:"Enter Login Seed phrase"},model:{value:e.form.seed,callback:function(t){e.$set(e.form,"seed",t)},expression:"form.seed"}})],1),r("b-button",{attrs:{variant:"primary",disabled:e.confirmInProgress,type:"submit"}},[e.confirmInProgress?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e._v(" Confirm ")])],1)],1)],1)],1)],1)},M=[],D={props:["order","address","maxTonAmount"],data:function(){return{form:{seed:"",value:0,recipientAltAddress:""},sourceCurrency:"",targetCurrency:"",lockTime:0,confirmInProgress:!1,alert:!1,alertMsg:""}},created:function(){console.log("created",this.order),this.lockTime=this.$options.filters.formatHour(this.order.timeLockSlot,!0)+" Hour(s)",this.sourceCurrency=this.$swapOrderbook.translateToken(this.order.fromToken),this.targetCurrency=this.$swapOrderbook.translateToken(this.order.toToken)},mounted:function(){var e,t=this;e="TON CRYSTAL"===this.order.fromToken?this.order.toToken:this.order.fromToken,"ETH"!==e&&"USDT"!==e||this.$swapOrderbook.swappers.ETH.waitEthAddresses().then((function(e){void 0!==e[0]&&""===t.form.recipientAltAddress&&(t.form.recipientAltAddress=e[0])}))},computed:{foreignValue:function(){return"TON CRYSTAL"!==this.order.fromToken?this.$altValue(this.order.foreignValue,this.order.fromToken):this.$tonValue(this.order.value)},foreignMinValue:function(){return"TON CRYSTAL"!==this.order.fromToken?this.$altValue(this.order.foreignMinValue,this.order.fromToken):this.$tonValue(this.order.minValue)},targetValue:function(){return"TON CRYSTAL"===this.order.fromToken?this.$options.filters.formatAlt(this.form.value*this.$altValue(this.order.exchangeRate,this.order.toToken),this.order.toToken):this.$options.filters.formatTon(this.form.value/this.$altValue(this.order.exchangeRate,this.order.fromToken))},maxLock:function(){return this.$options.filters.formatHour(this.order.timeLockSlot)},exchangeRate:function(){return console.log("rate",this.order.exchangeRate),this.$options.filters.formatAltHex(this.order.exchangeRate,"TON CRYSTAL"===this.order.fromToken?this.order.toToken:this.order.fromToken)}},methods:{amountStep:function(){return"TON CRYSTAL"===this.order.fromToken?"0.000000001":"BTC"===this.order.fromToken?"0.00000001":"ETH"===this.order.fromToken?"0.000000001":"USDT"===this.order.fromToken?"0.000001":"1"},confirmOrder:function(e){var t=this;e.preventDefault(),this.confirmInProgress=!0;var r=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var r,n,a,s,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,"TON CRYSTAL"!==t.order.fromToken){e.next=6;break}n=t.form.value,r=t.$convertValue("TON CRYSTAL",n),e.next=14;break;case 6:if(a=t.form.value/t.$altValue(t.order.exchangeRate,t.order.fromToken),!(1e9*a>t.$BigInt(t.maxTonAmount))){e.next=9;break}throw Error("Insufficient balance");case 9:return r=t.$convertValue("TON CRYSTAL",a),e.next=12,t.$swapOrderbook.getAltValue(r,t.order.exchangeRate);case 12:s=e.sent,console.log("foreignValue",r,s,t.order.foreignValue,t.order.foreignMinValue);case 14:return e.next=16,t.$swapOrderbook.ordersWatcher.newOrder();case 16:return i=e.sent,e.next=19,i.confirmOrder(t.order,r,t.form.recipientAltAddress,t.address,t.form.seed);case 19:return e.next=21,t.$swapOrderbook.updateInfo();case 21:o=e.sent,t.confirmInProgress=!1,t.$emit("orderConfirmed",o),e.next=36;break;case 26:return e.prev=26,e.t0=e["catch"](0),console.log("confirmOrder error",e.t0),t.alertMsg="Failed to create order: "+e.t0.message.toString(),t.alert=!0,e.next=33,new Promise((function(e){return setTimeout(e,3e3)}));case 33:t.alert=!1,t.alertMsg="",t.confirmInProgress=!1;case 36:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(){return e.apply(this,arguments)}}();r()}}},L=D,N=Object(l["a"])(L,H,M,!1,null,"4cabe6d0",null),$=N.exports,W=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",{staticClass:"mb-4"},[r("b-col",{attrs:{sm:"12"}},[r("b-card",{attrs:{"border-variant":"primary",header:"BUY "+e.token,"header-bg-variant":"primary","header-text-variant":"white",align:"center"}},[e.loading||!e.loading&&0===e.orders.length?r("b-card-text",[e.loading?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e.loading||0!==e.orders.length?e._e():r("span",[e._v("There are no orders yet")])]):e._e(),e.logged?r("div",[r("b-button",{staticClass:"btn-primary float-left mb-2",attrs:{variant:"primary"},on:{click:e.createOrder}},[e._v("Create order")])],1):e._e(),!e.loading&&e.orders.length>e.perPage?r("b-pagination",{staticClass:"float-right",attrs:{"total-rows":e.rows,"per-page":e.perPage,"aria-controls":"ordersTable"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}):e._e(),!e.loading&&e.orders.length>0?r("b-table",{attrs:{id:"ordersTable",hover:"",items:e.orders,fields:e.fields,"per-page":e.perPage,"current-page":e.currentPage},scopedSlots:e._u([{key:"cell(actions)",fn:function(t){return[r("b-button",{attrs:{size:"sm"},on:{click:function(r){return e.swap(t.item,t.index)}}},[e._v(" Swap ")])]}}],null,!1,1774090124)}):e._e()],1)],1)],1),r("b-row",{staticClass:"mb-4"},[r("b-col",{attrs:{sm:"12"}},[r("b-card",{attrs:{"border-variant":"primary",header:"SELL "+e.token,"header-bg-variant":"primary","header-text-variant":"white",align:"center"}},[e.loadingReversed||!e.loadingReversed&&0===e.ordersReversed.length?r("b-card-text",[e.loadingReversed?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e.loadingReversed||0!==e.ordersReversed.length?e._e():r("span",[e._v("There are no orders yet")])]):e._e(),e.logged?r("div",[r("b-button",{staticClass:"btn-primary float-left mb-2",attrs:{variant:"primary"},on:{click:e.createOrderReversed}},[e._v("Create order")])],1):e._e(),!e.loadingReversed&&e.ordersReversed.length>e.perPage?r("b-pagination",{staticClass:"float-right",attrs:{"total-rows":e.rowsReversed,"per-page":e.perPage,"aria-controls":"ordersTableReversed"},model:{value:e.currentPageReversed,callback:function(t){e.currentPageReversed=t},expression:"currentPageReversed"}}):e._e(),!e.loadingReversed&&e.ordersReversed.length>0?r("b-table",{attrs:{id:"ordersTableReversed",hover:"",items:e.ordersReversed,fields:e.fields,"per-page":e.perPage,"current-page":e.currentPageReversed},scopedSlots:e._u([{key:"cell(actions)",fn:function(t){return[e.logged?r("b-button",{attrs:{size:"sm"},on:{click:function(r){return e.swap(t.item,t.index)}}},[e._v(" Swap ")]):e._e()]}}],null,!1,1611700561)}):e._e()],1)],1)],1)],1)},V=[],U={props:["logged","token"],data:function(){return{loading:!0,loadingReversed:!0,fields:[{key:"rate",label:"Exchange Rate"},{key:"amount",label:"Amount Range"},{key:"lockTime",label:"Timelock (Hours)"},{key:"actions",label:"Actions"}],orders:[],ordersReversed:[],currentPage:1,perPage:6,currentPageReversed:1}},mounted:function(){console.log("OrderList mounted"),this.timerDirect&&(clearTimeout(this.timerDirect),this.timerDirect=void 0),this.timerReversed&&(clearTimeout(this.timerReversed),this.timerReversed=void 0),this.updateDirectOrderbook(),this.updateReversedOrderbook()},beforeDestroy:function(){console.log("OrderList unmounted"),this.timerDirect&&(clearTimeout(this.timerDirect),this.timerDirect=void 0),this.timerReversed&&(clearTimeout(this.timerReversed),this.timerReversed=void 0)},watch:{token:function(e){this.loading=!0,this.loadingReversed=!0,this.timerDirect&&(clearTimeout(this.timerDirect),this.timerDirect=void 0),this.timerReversed&&(clearTimeout(this.timerReversed),this.timerReversed=void 0),this.updateDirectOrderbook(),this.updateReversedOrderbook()}},computed:{rows:function(){return this.orders.length},rowsReversed:function(){return this.ordersReversed.length}},methods:{updateDirectOrderbook:function(){var e=this,t=this.token;this.$swapOrderbook.isInited()?this.$swapOrderbook.getOrders("TON CRYSTAL",this.token).then((function(r){if(e.token===t){for(var n in console.log("getOrders:",r),e.orders=[],r){var a=r[n],s={rate:e.$options.filters.formatAltHex(a.exchangeRate,e.token),amount:a.value===a.minValue?e.$options.filters.formatTonHex(a.value):e.$options.filters.formatTonHex(a.minValue)+" - "+e.$options.filters.formatTonHex(a.value),lockTime:e.$options.filters.formatHour(a.timeLockSlot),order:a};e.orders.push(s)}e.loading=!1,e.timerDirect=setTimeout(e.updateDirectOrderbook,3e4)}})).catch((function(e){})):this.timerDirect=setTimeout(this.updateDirectOrderbook,1e4)},updateReversedOrderbook:function(){var e=this,t=this.token;this.$swapOrderbook.isInited()?this.$swapOrderbook.getOrders(this.token,"TON CRYSTAL").then((function(r){if(e.token===t){for(var n in console.log("getOrders:",r),e.ordersReversed=[],r){var a=r[n],s={rate:e.$options.filters.formatAltHex(a.exchangeRate,e.token),amount:a.foreignValue===a.foreignMinValue?e.$options.filters.formatAltHex(a.foreignValue,e.token):e.$options.filters.formatAltHex(a.foreignMinValue,e.token)+" - "+e.$options.filters.formatAltHex(a.foreignValue,e.token),lockTime:e.$options.filters.formatHour(a.timeLockSlot),order:a};e.ordersReversed.push(s)}e.loadingReversed=!1,e.timerReversed=setTimeout(e.updateReversedOrderbook,3e4)}})).catch((function(e){})):this.timerReversed=setTimeout(this.updateReversedOrderbook,1e4)},createOrder:function(){this.$emit("createOrder","TON CRYSTAL",this.token)},createOrderReversed:function(){this.$emit("createOrder",this.token,"TON CRYSTAL")},swap:function(e,t){console.log("swap",e,t),this.$emit("confirmOrder",e.order)}}},B=U,G=Object(l["a"])(B,W,V,!1,null,"5a4cd08c",null),F=G.exports,j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",{staticClass:"mb-4"},[r("b-col",{attrs:{sm:"12"}},[r("b-card",{attrs:{"border-variant":"primary",header:"MY ORDERS","header-bg-variant":"primary","header-text-variant":"white",align:"center"}},[e.loading||!e.loading&&0===e.orders.length?r("b-card-text",[e.loading?r("span",{staticClass:"spinner-border spinner-border-sm",attrs:{role:"status","aria-hidden":"true"}}):e._e(),e.loading||0!==e.orders.length?e._e():r("span",[e._v("There are no orders yet")])]):e._e(),e.loading?e._e():r("div",[r("b-button",{staticClass:"btn-primary float-left mb-2",attrs:{disabled:e.freshing,variant:"primary"},on:{click:e.updateOrders}},[e._v("Refresh")])],1),!e.loading&&e.orders.length>e.perPage?r("b-pagination",{staticClass:"float-right",attrs:{"total-rows":e.rows,"per-page":e.perPage,"aria-controls":"ordersTable"},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}):e._e(),!e.loading&&e.orders.length>0?r("b-table",{attrs:{id:"ordersTable",hover:"",items:e.orders,fields:e.fields,"per-page":e.perPage,"current-page":e.currentPage},scopedSlots:e._u([{key:"cell(actions)",fn:function(t){return[r("b-button",{staticClass:"mr-1 mb-1",attrs:{size:"sm",disabled:!e.isClosePossible(t.item)},on:{click:function(r){return e.close(t.item,t.index)}}},[e._v(" Close ")]),r("b-button",{attrs:{size:"sm"},on:{click:t.toggleDetails}},[e._v(" "+e._s(t.detailsShowing?"Hide":"Show")+" Info ")])]}},{key:"row-details",fn:function(t){return[r("b-card",{staticClass:"text-sm-left"},e._l(t.item.info,(function(t,n){return r("div",{key:n},[e._v(e._s(n)+": "),r("span",{domProps:{innerHTML:e._s(t)}}),r("br")])})),0)]}}],null,!1,991885298)}):e._e()],1)],1)],1)],1)},Y=[],q={props:["address"],data:function(){return{loading:!0,freshing:!1,fields:[{key:"status",label:"Status"},{key:"amount",label:"Amount Range"},{key:"fromToken",label:"From"},{key:"toToken",label:"To"},{key:"rate",label:"Exchange rate"},{key:"lockedUntil",label:"Locked Until"},{key:"actions",label:"Actions"}],orders:[],currentPage:1,perPage:10}},created:function(){this.updateOrders()},mounted:function(){console.log("MyOrders mounted"),this.timer&&(clearTimeout(this.timer),this.timer=void 0),this.updateOrders()},beforeDestroy:function(){console.log("MyOrders unmounted"),this.timer&&(clearTimeout(this.timer),this.timer=void 0)},computed:{rows:function(){return this.orders.length}},methods:{updateOrders:function(){var e=this;this.freshing=!0,setTimeout((function(){var t=e.$swapOrderbook.ordersWatcher.getOrders(),r=[];for(var n in t){var a=t[n];if(void 0!==a.order){var s=a.order.direct?a.order.toToken:a.order.fromToken;console.log("order:",a);var i={status:a.status,rate:e.$options.filters.formatAltHex(a.order.exchangeRate,s),fromToken:a.order.fromToken,toToken:a.order.toToken,lockedUntil:void 0!==a.tonWithdrawUntil?e.$options.filters.formatTime(a.tonWithdrawUntil):"Wait for confirmation",order:a,info:{Secret:a.secret,"Secret hash":a.order.secretHash,"Confirmation time":e.$options.filters.formatTime(a.confirmedTm)}};for(var o in a.order.confirmed?i.amount=e.$options.filters.formatTonHex(a.order.value):a.order.direct?i.amount=a.order.value===a.order.minValue?e.$options.filters.formatTonHex(a.order.value):e.$options.filters.formatTonHex(a.order.minValue)+" - "+e.$options.filters.formatTonHex(a.order.value):i.amount=a.order.foreignValue===a.order.foreignMinValue?e.$options.filters.formatAltHex(a.order.foreignValue,s):e.$options.filters.formatAltHex(a.order.foreignMinValue,s)+" - "+e.$options.filters.formatAltHex(a.order.foreignValue,s),a.altCreateUntil&&(i.info[s+" order creation until time"]=e.$options.filters.formatTime(a.altCreateUntil)),a.altWithdrawUntil&&(i.info[s+" order withdraw until time"]=e.$options.filters.formatTime(a.altWithdrawUntil)),a.tonWithdrawUntil&&(i.info["TON order withdraw until time"]=e.$options.filters.formatTime(a.tonWithdrawUntil)),a.tonCreateTxId&&(i.info["TON order create TXID"]=e.$options.filters.makeTxLink(a.tonCreateTxId,"TON CRYSTAL"),i.info["TON order create time"]=e.$options.filters.formatTime(a.tonCreateTxTm)),a.tonConfirmTxId&&(i.info["TON order confirm TXID"]=e.$options.filters.makeTxLink(a.tonConfirmTxId,"TON CRYSTAL"),i.info["TON order confirm time"]=e.$options.filters.formatTime(a.tonConfirmTxTm)),a.altApproveTxId&&(i.info[s+" order approve TXID"]=e.$options.filters.makeTxLink(a.altApproveTxId,s),i.info[s+" order approve time"]=e.$options.filters.formatTime(a.altApproveTxTm)),a.altTxId&&(i.info[s+" order create TXID"]=e.$options.filters.makeTxLink(a.altTxId,s),i.info[s+" order create time"]=e.$options.filters.formatTime(a.altTxTm)),a.altFinishTxId&&(i.info[s+" order withdraw TXID"]=e.$options.filters.makeTxLink(a.altFinishTxId,s),i.info[s+" order withdraw time"]=e.$options.filters.formatTime(a.altFinishTxTm)),a.tonFinishTxId&&(i.info["TON order withdraw TXID"]=e.$options.filters.makeTxLink(a.tonFinishTxId,"TON CRYSTAL"),i.info["TON order withdraw time"]=e.$options.filters.formatTime(a.tonFinishTxTm)),e.orders)if(e.orders[o].order&&void 0!==e.orders[o].order.order.secretHash&&void 0!==i.order.order.secretHash&&e.orders[o].order.order.secretHash.toLowerCase()===i.order.order.secretHash.toLowerCase()){i._showDetails=e.orders[o]._showDetails;break}r.push(i)}else{var u={status:a.status,rate:"",fromToken:"",toToken:"",lockedUntil:""};console.log("c:",u),r.push(u)}}e.orders=r.reverse(),e.freshing=!1,e.loading=!1,e.timer=setTimeout(e.updateOrders,1e4)}),0)},close:function(e,t){var r=this;console.log("close",e,t);var n=prompt("Enter a Free TON wallet seed phrase");this.$swapOrderbook.closeOrder(e.order.order,n).then((function(e){r.updateOrders()}))},isClosePossible:function(e){return"created"===e.status}}},J=q,X=Object(l["a"])(J,j,Y,!1,null,"15a2cfa8",null),K=X.exports,z={name:"App",components:{Login:f,Withdraw:y,Deposit:S,NewOrder:P,ConfirmOrder:$,OrderList:F,MyOrders:K},data:function(){return{alert:!1,isLogged:!1,address:"",seed:"",balance:{freeFunds:"0x0",ordersFunds:"0x0",lockedFunds:"0x0"},newOrder:{fromToken:"",toToken:"",altToken:"",sourceCurrency:"",targetCurrency:""},orderList:{token:"USDT"},newOrderConfirm:{},depositAddress:"0:d0032ed616eac41c8a5924c00e64e18b5083316e888bb9b5b34c4e32a9365f1d",tab:"usdt"}},mounted:function(){var e=this;this.$swapOrderbook.init().then((function(){var t=function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLogged){t.next=13;break}return e.$swapOrderbook.ordersWatcher.isInited()||e.$swapOrderbook.ordersWatcher.init(e.address,e.seed),e.$swapOrderbook.ordersWatcher.isAnyActive()?e.alert=!0:e.alert=!1,t.prev=4,t.next=7,e.$swapOrderbook.updateInfo();case 7:e.balance=t.sent,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](4),console.log("updateInfo error:",t.t0);case 13:return t.next=15,new Promise((function(e){return setTimeout(e,2e4)}));case 15:t.next=0;break;case 17:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(){return t.apply(this,arguments)}}();t()})).catch((function(e){console.log("init error:",e)}))},methods:{login:function(){"login"!==this.tab&&(this.tab="login")},logout:function(){this.$swapOrderbook.logout(),this.isLogged=!1,this.balance={},"eth"!==this.tab&&"usdt"!==this.tab&&"btc"!==this.tab&&this.login()},logged:function(e,t,r){this.isLogged=!0,this.balance=e,this.address=t,this.seed=r,console.log("login info:",e,t),this.$swapOrderbook.ordersWatcher.isInited()||this.$swapOrderbook.ordersWatcher.init(t,r),this.$swapOrderbook.ordersWatcher.isAnyActive()?this.alert=!0:this.alert=!1,this.usdt()},eth:function(){this.orderList.token="ETH",this.tab="eth"},usdt:function(){this.orderList.token="USDT",this.tab="usdt"},btc:function(){this.orderList.token="BTC",this.tab="btc"},orders:function(){this.tab="orders",console.log("orders")},deposit:function(){this.tab="deposit",console.log("deposit")},deposited:function(e){this.balance=e,this.usdt()},withdraw:function(){this.tab="withdraw",console.log("withdraw")},withdrawn:function(e){this.balance=e,this.usdt()},createOrder:function(e,t){this.newOrder.fromToken=e,this.newOrder.toToken=t,this.newOrder.altToken="TON CRYSTAL"===e?t:e,this.tab="newOrder"},orderCreated:function(e){this.balance=e,this.orders()},confirmOrder:function(e){this.newOrderConfirm=e,this.tab="confirmOrder"},orderConfirmed:function(e){this.balance=e,this.orders()}}},Q=z,Z=(r("034f"),Object(l["a"])(Q,s,i,!1,null,null,null)),ee=Z.exports,te=(r("f9e3"),r("2dd8"),r("91ba")),re=r("6612"),ne=r.n(re),ae=r("e550"),se=r.n(ae);n["default"].prototype.$swapOrderbook=new se.a("0:661a85a4912ff3a1994bc4e7039ca9f14f9d8e24bb3910d657c998a931739fb3"),n["default"].prototype.$BigInt=te["BigInteger"],n["default"].use(a["a"]),n["default"].config.productionTip=!1,n["default"].filter("formatTon",(function(e){return ne()(e).format("0,0.00")})),n["default"].filter("formatTonHex",(function(e){return e=Object(te["BigInteger"])(e).quotient(1e6).toJSValue()/1e3,ne()(e).format("0,0.00")})),n["default"].filter("formatHour",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=t?parseInt(e,16)/3600:3*parseInt(e,16)/3600,ne()(e).format("0.0")})),n["default"].filter("formatTime",(function(e){return e?new Date(1e3*e).toISOString().slice(-24,-5).replace("T"," ")+" UTC":""})),n["default"].filter("makeTxLink",(function(e,t){return"TON CRYSTAL"===t?'<a href="https://net.ton.live/transactions?section=details&id='+e+'" >'+e+"</a>":"ETH"===t||"USDT"===t?'<a href="https://ropsten.etherscan.io/tx/'+e+'" >'+e+"</a>":e})),n["default"].filter("formatAltHex",(function(e,t){return"ETH"===t?(e=Object(te["BigInteger"])(e).quotient(1e12).toJSValue()/1e6,ne()(e).format("0,0.00000")):"USDT"===t?(e=Object(te["BigInteger"])(e).quotient(1e3).toJSValue()/1e3,ne()(e).format("0,0.00")):"BTC"===t?(e=Object(te["BigInteger"])(e).toJSValue()/1e8,ne()(e).format("0,0.0000000")):"0"})),n["default"].filter("formatAlt",(function(e,t){return"ETH"===t?ne()(e).format("0,0.00000"):"USDT"===t?ne()(e).format("0,0.00"):"BTC"===t?ne()(e).format("0,0.0000000"):"0"})),n["default"].prototype.$altValue=function(e,t){return"ETH"===t?Object(te["BigInteger"])(e).quotient(1e12).toJSValue()/1e6:"USDT"===t?Object(te["BigInteger"])(e).quotient(1e3).toJSValue()/1e3:"BTC"===t?Object(te["BigInteger"])(e).toJSValue()/1e8:0},n["default"].prototype.$tonValue=function(e){return Object(te["BigInteger"])(e).quotient(1e6).toJSValue()/1e3},n["default"].prototype.$convertValue=function(e,t){return"TON CRYSTAL"===e?"0x"+Object(te["BigInteger"])(1e9*t).toString(16):"ETH"===e?"0x"+Object(te["BigInteger"])(1e9*t).multiply(1e9).toString(16):"USDT"===e?"0x"+Object(te["BigInteger"])(1e6*t).toString(16):"BTC"===e?"0x"+Object(te["BigInteger"])(1e8*t).toString(16):"0x0"},n["default"].prototype.$convertRate=function(e,t){return"ETH"===e?"0x"+Object(te["BigInteger"])(1e9*t).multiply(1e9).toString(16):"USDT"===e?"0x"+Object(te["BigInteger"])(1e6*t).toString(16):"BTC"===e?"0x"+Object(te["BigInteger"])(1e8*t).toString(16):"0x0"},n["default"].prototype.$convertAltAddress=function(e,t){return"ETH"===e||"USDT"===e?t:"0x0"},new n["default"]({render:function(e){return e(ee)}}).$mount("#app")},6:function(e,t){},6993:function(e,t,r){r("d3b7"),r("ddb0"),r("9577");var n=r("c973"),a=r("970b"),s=r("5bc3"),i=r("2f54"),o=r("a210"),u=o.BigInteger,c=function(){"use strict";function e(t){a(this,e),this.client=t,this.abi=i}return s(e,[{key:"runSmcMethod",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},n=s.length>2?s[2]:void 0,console.log("wallet runSmcMethod"),console.log("address",this.smcAddress),console.log("abi",this.TonSwapOrderbookAbi),console.log("functionName",t),console.log("input",r),console.log("keys",n),e.next=10,this.client.contracts.run({address:this.address,abi:this.abi,functionName:t,input:r,keyPair:n});case 10:return a=e.sent,console.log("output",a),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"runGetMethod",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},console.log("wallet runGetMethod"),console.log("address",this.smcAddress),console.log("abi",this.TonSwapOrderbookAbi),console.log("functionName",t),console.log("input",r),e.next=8,this.client.contracts.runLocal({address:this.address,abi:this.abi,functionName:t,fullRun:!1,input:r});case 8:return n=e.sent,console.log("output",n),e.abrupt("return",n.output);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"login",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n="m/44'/396'/0'/0/0",e.next=4,this.client.crypto.mnemonicDeriveSignKeys({dictionary:1,wordCount:12,phrase:r,path:n});case 4:this.keyPair=e.sent,console.log("Tonos-compatible key pair:"),console.log(this.keyPair),e.next=12;break;case 9:throw e.prev=9,e.t0=e["catch"](0),Error("Invalid seed phrase");case 12:return this.address=t,this.seed=r,e.prev=14,e.next=17,this.runGetMethod("getCustodians");case 17:a=e.sent,e.t1=regeneratorRuntime.keys(a.custodians);case 19:if((e.t2=e.t1()).done){e.next=28;break}if(s=e.t2.value,i=a.custodians[s].pubkey,console.log("custodian",i),0!==u("0x"+this.keyPair.public).compare(i)){e.next=26;break}return console.log("found custodian"),e.abrupt("return");case 26:e.next=19;break;case 28:e.next=33;break;case 30:throw e.prev=30,e.t3=e["catch"](14),Error("Cannot get account state");case 33:throw Error("No such custodian");case 34:case"end":return e.stop()}}),e,this,[[0,9],[14,30]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getAddress",value:function(){return this.address}},{key:"transact",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r){var n,a,s,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:"",e.next=3,this.runSmcMethod("submitTransaction",{dest:r,value:t,bounce:!0,allBalance:!1,payload:n},this.keyPair);case 3:return a=e.sent,s={transaction_id:a.transaction.id,fees:a.fees.totalAccountFees,output:a.fees.totalOutput},e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getAccount",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=t||this.address,e.next=3,this.client.contracts.getAccount(t,!0);case 3:return r=e.sent,console.log("getAccount",r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}();e.exports=c},"6ecb":function(e,t,r){r("d3b7"),r("25f0");var n=r("970b"),a=r("5bc3");r("9577");var s=r("c973"),i=r("899e"),o=r("57f2"),u=r("ca53"),c=u.testnet_config,d=function(){"undefined"!==typeof window&&window.ethereum&&(window.web3=new o(window.ethereum))},p=function(){return!("undefined"===typeof window||!window.ethereum)&&(window.web3=new o(window.ethereum),window.ethereum.enable(),!0)},l=function(){var e=s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,window.web3.eth.getAccounts();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=s(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(p()){e.next=5;break}return e.next=3,new Promise((function(e){return setTimeout(e,1e3)}));case 3:e.next=0;break;case 5:return e.next=7,l();case 7:if(e.t0=e.sent.length,0!==e.t0){e.next=13;break}return e.next=11,new Promise((function(e){return setTimeout(e,5e3)}));case 11:e.next=5;break;case 13:return e.next=15,l();case 15:return t=e.sent,console.log("ethereum addresses",t),e.abrupt("return",t);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){"use strict";function e(t,r,a,s){n(this,e),this.sourceAddress=t,this.targetAddress=r,this.secretHash=a,this.config=s||c,this.swap=new i({mainnet:this.config.isMainnet,address:this.config.contracts.eth_address,abi:this.config.contracts.eth_abi,gasLimit:3e5,gasPrice:2e9,getParticipantAddress:function(){return t}})}return a(e,[{key:"create",value:function(){var e=s(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.transactionHash&&!this.swapObj){e.next=2;break}throw Error("Already created");case 2:return this.amount=t,e.prev=3,e.next=6,this.swap.create({secretHash:this.secretHash,participantAddress:this.targetAddress,amount:this.amount},(function(e){r.transactionHash=e}));case 6:console.log("_transactionHash",this.transactionHash),e.next=13;break;case 9:throw e.prev=9,e.t0=e["catch"](3),console.log("error create",e.t0),Error("Cannot send Ethereum transaction");case 13:return e.abrupt("return",this.transactionHash);case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdrawWithTimeout",value:function(){var e=s(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.swap.refund({participantAddress:this.targetAddress});case 3:return t=e.sent,console.log("withdrawWithTimeout result",t),e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e["catch"](0),Error("Cannot withdraw");case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSwap",value:function(){var e=s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.swaps({ownerAddress:this.sourceAddress,participantAddress:this.targetAddress});case 2:return this.swapObj=e.sent,console.log("swapObj",this.swapObj),e.abrupt("return",this.swapObj);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMyBalance",value:function(){var e=s(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.fetchBalance(this.sourceAddress);case 2:return t=e.sent,console.log("sourceAddress balance",t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getGasPrice",value:function(){var e=s(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"fast",e.next=3,this.swap.estimateGasPrice(t);case 3:return r=e.sent,console.log("gasPrice",r.toString(10)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),m=function(){"use strict";function e(t,r,a,s,o){n(this,e),this.sourceAddress=t,this.targetAddress=r,this.secret=a,this.secretHash=s,this.config=o||c,this.swap=new i({mainnet:this.config.isMainnet,address:this.config.contracts.eth_address,abi:this.config.contracts.eth_abi,gasLimit:3e5,gasPrice:2e9,getParticipantAddress:function(){return r}})}return a(e,[{key:"checkSwapParams",value:function(){var e=s(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.balance===this.value){e.next=2;break}return e.abrupt("return",!1);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getSwap",value:function(){var e=s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.swaps({ownerAddress:this.sourceAddress,participantAddress:this.targetAddress});case 2:return this.swapObj=e.sent,console.log("swapObj",this.swapObj),e.abrupt("return",this.swapObj);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"withdraw",value:function(){var e=s(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.swap.withdraw({secret:this.secret,ownerAddress:this.sourceAddress},(function(e){r.transactionHash=e}));case 3:return t=e.sent,console.log("receipt:",t),e.abrupt("return",this.transactionHash);case 8:throw e.prev=8,e.t0=e["catch"](0),console.log("withdraw error:",e.t0),Error("Withdraw error");case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMyBalance",value:function(){var e=s(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.fetchBalance(this.targetAddress);case 2:return t=e.sent,console.log("sourceAddress balance",t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getGasPrice",value:function(){var e=s(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"fast",e.next=3,this.swap.estimateGasPrice(t);case 3:return r=e.sent,console.log("gasPrice",r.toString(10)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}();e.exports={ethInit:d,ethEnabled:p,waitEthAddresses:h,EthSwapInitiator:f,EthSwapReceiver:m}},7:function(e,t){},"719a":function(e,t,r){r("d3b7"),r("25f0"),r("9577");var n=r("c973"),a=r("970b"),s=r("5bc3"),i=r("fc3e"),o=(r("57f2"),r("ca53")),u=o.testnet_config,c=function(){"use strict";function e(t,r,n,s,o){a(this,e),this.sourceAddress=r,this.targetAddress=n,this.secretHash=s,this.config=o||u,this.tokenAddress=this.config.tokens[t].address,this.token=t,this.swap=new i({mainnet:this.config.isMainnet,address:this.config.contracts.eth_token_address,abi:this.config.contracts.eth_token_abi,name:t,decimals:this.config.tokens[t].decimals,tokenAddress:this.config.tokens[t].address,tokenAbi:this.config.tokens[t].abi,gasLimit:4e5,gasPrice:2e9,getParticipantAddress:function(){return r}})}return s(e,[{key:"create",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.transactionHash&&!this.swapObj){e.next=2;break}throw Error("Already created");case 2:return this.amount=t,e.prev=3,e.next=6,this.swap.create({secretHash:this.secretHash,participantAddress:this.targetAddress,amount:this.amount},(function(e){r.transactionHash=e}));case 6:console.log("_transactionHash",this.transactionHash),e.next=13;break;case 9:throw e.prev=9,e.t0=e["catch"](3),console.log("error create",e.t0),Error("Cannot send Ethereum transaction");case 13:return e.abrupt("return",this.transactionHash);case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdrawWithTimeout",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.swap.refund({participantAddress:this.targetAddress});case 3:return t=e.sent,console.log("withdrawWithTimeout result",t),e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e["catch"](0),Error("Cannot withdraw");case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSwap",value:function(){var e=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.swaps({ownerAddress:this.sourceAddress,participantAddress:this.targetAddress});case 2:return this.swapObj=e.sent,console.log("swapObj",this.swapObj),e.abrupt("return",this.swapObj);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"approve",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.swap.approve({amount:t});case 3:return r=e.sent,console.log("approve result",r),e.abrupt("return",r?r.transactionHash:void 0);case 8:throw e.prev=8,e.t0=e["catch"](0),Error("Cannot approve");case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"checkApprove",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.swap.checkAllowance({spender:this.sourceAddress});case 3:return t=e.sent,console.log("checkApprove result",t),e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e["catch"](0),Error("Cannot checkApprove");case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMyBalance",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.fetchBalance(this.sourceAddress);case 2:return t=e.sent,console.log("sourceAddress balance",t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getGasPrice",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"fast",e.next=3,this.swap.estimateGasPrice(t);case 3:return r=e.sent,console.log("gasPrice",r.toString(10)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),d=function(){"use strict";function e(t,r,n,s,o,c){a(this,e),this.sourceAddress=r,this.targetAddress=n,this.secret=s,this.secretHash=o,this.config=c||u,this.tokenAddress=this.config.tokens[t].address,this.token=t,this.swap=new i({mainnet:this.config.isMainnet,address:this.config.contracts.eth_token_address,abi:this.config.contracts.eth_token_abi,name:t,decimals:this.config.tokens[t].decimals,tokenAddress:this.config.tokens[t].address,tokenAbi:this.config.tokens[t].abi,gasLimit:4e5,gasPrice:2e9,getParticipantAddress:function(){return n}})}return s(e,[{key:"checkSwapParams",value:function(){var e=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.balance===this.value){e.next=2;break}return e.abrupt("return",!1);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getSwap",value:function(){var e=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.swaps({ownerAddress:this.sourceAddress,participantAddress:this.targetAddress});case 2:return this.swapObj=e.sent,console.log("swapObj",this.swapObj),e.abrupt("return",this.swapObj);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"withdraw",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.swap.withdraw({secret:this.secret,ownerAddress:this.sourceAddress},(function(e){r.transactionHash=e}));case 3:return t=e.sent,console.log("receipt:",t),e.abrupt("return",this.transactionHash);case 8:throw e.prev=8,e.t0=e["catch"](0),console.log("withdraw error:",e.t0),Error("Withdraw error");case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMyBalance",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swap.fetchBalance(this.targetAddress);case 2:return t=e.sent,console.log("sourceAddress balance",t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getGasPrice",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"fast",e.next=3,this.swap.estimateGasPrice(t);case 3:return r=e.sent,console.log("gasPrice",r.toString(10)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}();e.exports={EthTokenSwapInitiator:c,EthTokenSwapReceiver:d}},8:function(e,t){},"85ec":function(e,t,r){},"899e":function(e,t,r){r("99af"),r("4de4"),r("fb6a"),r("d3b7"),r("ac1f"),r("25f0"),r("5319"),r("1276");var n=r("278c"),a=r("480f"),s=r("448a"),i=r("ded3");r("9577");var o=r("c973"),u=r("970b"),c=r("5bc3"),d=r("7876"),p=r("57f2"),l=r("af6c"),h=r("e8d6"),f=r("e3ba"),m=f.mainnet,w=f.testnet,b=function(){"use strict";function e(t){var r=this;if(u(this,e),"string"!==typeof t.address)throw new Error('EthSwap: "address" required');if(!Array.isArray(t.abi))throw new Error('EthSwap: "abi" required');if("function"!==typeof t.getParticipantAddress)throw new Error('EthSwap: "getParticipantAddress" required');this.web3="undefined"!==typeof window&&window.web3?window.web3:new p(new p.providers.HttpProvider(t.provider)),this.ethereum=t.mainnet?m():w(),this.fetchBalance=function(e){return r.ethereum.fetchBalance(e)},this.estimateGasPrice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speed;return r.ethereum.estimateGasPrice({speed:t})},this.getParticipantAddress=t.getParticipantAddress,this.address=t.address,this.abi=t.abi,this._swapName="ETH",this.gasLimit=t.gasLimit||3e5,this.gasPrice=t.gasPrice||2e9,this.decoder=new l(this.abi),this.contract=new this.web3.eth.Contract(this.abi,this.address)}return c(e,[{key:"updateGas",value:function(){return console.warn("EthSwap.updateGas() is deprecated and will be removed. Use .updateGasPrice()"),updateGasPrice()}},{key:"updateGasPrice",value:function(){var e=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return h("gas price before update",this.gasPrice),e.prev=1,e.next=4,this.estimateGasPrice({speed:"fast"});case 4:this.gasPrice=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),h("EthSwap: Error with gas update: ".concat(e.t0.message,", using old value gasPrice=").concat(this.gasPrice));case 10:h("gas price after update",this.gasPrice);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"create",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.targetWallet||t.targetWallet===t.participantAddress||!this.hasTargetWallet()){e.next=4;break}return e.abrupt("return",this.createSwapTarget(t,r));case 4:return e.abrupt("return",this.createSwap(t,r));case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"send",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,u=this,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3?c[3]:void 0,"function"===typeof this.contract.methods[t]){e.next=4;break}throw new Error("EthSwap.send: No method ".concat(t," in contract"));case 4:return e.next=6,this.updateGasPrice();case 6:return e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(o,c){var d,p,l,f,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return l=i({from:u.getParticipantAddress(),gas:u.gasLimit,gasPrice:u.gasPrice},n),h("EthSwap -> ".concat(t," -> params"),l),e.next=4,(d=u.contract.methods)[t].apply(d,s(r)).estimateGas(l);case 4:return f=e.sent,l.gas=f,h("EthSwap -> ".concat(t," -> gas"),f),e.next=9,(p=u.contract.methods)[t].apply(p,s(r)).send(l).on("transactionHash",(function(e){"function"===typeof a&&a(e)})).on("error",(function(e){c(e)}));case 9:m=e.sent,o(m);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSwap",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s,i,o,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.secretHash,a=t.participantAddress,s=t.amount,i=s,o="0x".concat(n.replace(/^0x/,"")),u=[o,a],e.abrupt("return",this.send("createSwap",[].concat(u),{value:i},r));case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSwapTarget",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s,i,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.secretHash,a=t.participantAddress,s=t.amount,i=t.targetWallet,e.next=3,this.updateGasPrice();case 3:return o=s,u="0x".concat(n.replace(/^0x/,"")),c=[u,a,i],e.abrupt("return",this.send("createSwapTarget",[].concat(c),{value:o},r));case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getBalance",value:function(e){var t=e.ownerAddress;return this.contract.methods.getBalance(t).call({from:this.getParticipantAddress()})}},{key:"swaps",value:function(e){var t=e.ownerAddress,r=e.participantAddress;return this.contract.methods.swaps(t,r).call()}},{key:"checkSwapExists",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swaps(t);case 2:return r=e.sent,h("swapExists",r),n=r&&r.balance?parseInt(r.balance):0,e.abrupt("return",n>0);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"checkBalance",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,a,s,i,o,u,c,p,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.ownerAddress,n=t.participantAddress,a=t.expectedValue,s=t.expectedHash,e.next=3,util.helpers.repeatAsyncUntilResult((function(){return l.getBalance({ownerAddress:r})}));case 3:return i=e.sent,e.next=6,util.helpers.repeatAsyncUntilResult((function(){return l.contract.methods.swaps(r,n).call()}));case 6:if(o=e.sent,u=o.secretHash,h("swap.secretHash",u),c="".concat(u.replace(/^0x/,"")),h("secretHash: expected hash = ".concat(s,", contract hash = ").concat(c)),s===c){e.next=13;break}return e.abrupt("return","Expected hash: ".concat(s,", got: ").concat(c));case 13:if(p=d(a).multipliedBy(1e18),!p.isGreaterThan(i)){e.next=16;break}return e.abrupt("return","Expected value: ".concat(p.toString(),", got: ").concat(i));case 16:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchSwapEvents",value:function(){var e=o(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._allSwapEvents){e.next=2;break}return e.abrupt("return",this._allSwapEvents);case 2:return e.next=4,this.contract.getPastEvents("allEvents",{fromBlock:0,toBlock:"latest"});case 4:return t=e.sent,this.contract.events.allEvents({fromBlock:0,toBlock:"latest"}).on("data",(function(e){r._allSwapEvents.push(e)})).on("changed",(function(e){console.error("EthSwap: fetchEvents: needs rescan"),r._allSwapEvents=null})).on("error",(function(e){console.error(e),r._allSwapEvents=null})),this._allSwapEvents=t,e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"findSwap",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,s,i,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.secretHash,e.next=3,this.fetchSwapEvents();case 3:return n=e.sent,s=n.filter((function(e){var t=e.returnValues;return t._secretHash==="0x".concat(r.replace("0x",""))})),i=a(s),o=i[0],u=i[1],c=i.slice(2),c&&c.length&&console.error("More than two swaps with same hash",c),e.abrupt("return",[o,u]);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"wasClosed",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.findSwap(t);case 2:if(r=e.sent,a=n(r,2),s=a[0],i=a[1],s){e.next=11;break}return h("No swap with hash ".concat(t.secretHash)),e.abrupt("return","no swap");case 11:if(!s||i){e.next=16;break}return h("Open yet!"),e.abrupt("return","open");case 16:if("Withdraw"!=i.event){e.next=21;break}return h("Withdrawn"),e.abrupt("return","withdrawn");case 21:if("Refund"!=i.event){e.next=26;break}return h("Refund"),e.abrupt("return","refunded");case 26:return h("Unknown event, error"),e.abrupt("return","error");case 28:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"wasRefunded",value:function(e){return this.wasClosed(e).then((function(e){return"refunded"===e}))}},{key:"wasWithdrawn",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.wasClosed(t);case 2:return r=e.sent,e.abrupt("return","withdrawn"===r);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"hasTargetWallet",value:function(){return!!this.contract.methods.getTargetWallet}},{key:"getTargetWallet",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("EthSwap->getTargetWallet"),e.next=3,util.helpers.repeatAsyncUntilResult((function(){return n.getTargetWalletPromise(t)}));case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getTargetWalletPromise",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(n,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.contract.methods.getTargetWallet(t).call({from:r.getParticipantAddress()});case 3:s=e.sent,n(s),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"calcWithdrawGas",value:function(){var e=o(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.calcWithdrawOtherGas({ownerAddress:t.ownerAddress,participantAddress:this.getParticipantAddress(),secret:t.secret}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdraw",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.withdrawOther({ownerAddress:t.ownerAddress,participantAddress:this.getParticipantAddress(),secret:t.secret},r));case 1:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"calcWithdrawNoMoneyGas",value:function(){var e=o(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.calcWithdrawOtherGas({ownerAddress:this.getParticipantAddress(),participantAddress:t.participantAddress,secret:t.secret}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdrawNoMoney",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.withdrawOther({ownerAddress:this.getParticipantAddress(),participantAddress:t.participantAddress,secret:t.secret},r));case 1:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"calcWithdrawOtherGas",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.ownerAddress,n=t.participantAddress,a=t.secret,e.next=3,this.updateGasPrice();case 3:return e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(t,i){var o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o="0x".concat(a.replace(/^0x/,"")),u={from:s.getParticipantAddress(),gas:s.gasLimit,gasPrice:s.gasPrice},e.prev=2,e.next=5,s.contract.methods.withdrawOther(o,r,n).estimateGas(u);case 5:c=e.sent,t(c),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](2),i(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,r){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdrawOther",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.ownerAddress,a=t.participantAddress,s=t.secret,i="0x".concat(s.replace(/^0x/,"")),e.next=4,this.updateGasPrice();case 4:return e.abrupt("return",this.send("withdrawOther",[i,n,a],{},r));case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"refund",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.participantAddress,e.next=3,this.updateGasPrice();case 3:return e.abrupt("return",this.send("refund",[n],{},r));case 4:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getSecret",value:function(e){var t=e.participantAddress;return this.contract.methods.getSecret(t).call({from:this.getParticipantAddress()}).then((function(e){return console.log("getSecret:",e),e})).catch((function(e){return e}))}},{key:"getSecretFromTxhash",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.web3.eth.getTransaction(t).then((function(e){try{var t=r.decoder.decodeData(e.input);return r.web3.utils.bytesToHex(t.inputs[0]).split("0x")[1]}catch(n){return void h("Trying to fetch secret from tx: "+n.message)}})));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}();e.exports=b},9:function(e,t){},ca53:function(e,t){var r={eth:"https://ropsten.infura.io/v3/42c75e22d2754274a6fc6a7ebd5c78bd",btc:"",ton:"dev."},n={eth_address:"0x953A583ac154e60C60CEA6C0323Bc12057f51253",eth_abi:[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"}],name:"Close",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"_secretHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"createdAt",type:"uint256"}],name:"CreateSwap",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"},{indexed:!1,internalType:"bytes32",name:"_secretHash",type:"bytes32"}],name:"Refund",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"},{indexed:!1,internalType:"bytes32",name:"_secretHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"withdrawnAt",type:"uint256"}],name:"Withdraw",type:"event"},{constant:!0,inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"ratingContractAddress",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"swaps",outputs:[{internalType:"addresspayable",name:"targetWallet",type:"address"},{internalType:"bytes32",name:"secret",type:"bytes32"},{internalType:"bytes32",name:"secretHash",type:"bytes32"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"uint256",name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secretHash",type:"bytes32"},{internalType:"addresspayable",name:"_participantAddress",type:"address"}],name:"createSwap",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secretHash",type:"bytes32"},{internalType:"addresspayable",name:"_participantAddress",type:"address"},{internalType:"addresspayable",name:"_targetWallet",type:"address"}],name:"createSwapTarget",outputs:[],payable:!0,stateMutability:"payable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_ownerAddress",type:"address"}],name:"getBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_ownerAddress",type:"address"}],name:"getTargetWallet",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secret",type:"bytes32"},{internalType:"address",name:"_ownerAddress",type:"address"}],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secret",type:"bytes32"},{internalType:"address",name:"participantAddress",type:"address"}],name:"withdrawNoMoney",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secret",type:"bytes32"},{internalType:"address",name:"_ownerAddress",type:"address"},{internalType:"address",name:"participantAddress",type:"address"}],name:"withdrawOther",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_participantAddress",type:"address"}],name:"getSecret",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_participantAddress",type:"address"}],name:"refund",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],eth_token_address:"0x9572145Adaefce2e7D3c1A5d28589df0E1011145",eth_token_abi:[{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"},{indexed:!1,internalType:"bytes32",name:"_secretHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"createdAt",type:"uint256"}],name:"CreateSwap",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"},{indexed:!1,internalType:"bytes32",name:"_secretHash",type:"bytes32"}],name:"Refund",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"_buyer",type:"address"},{indexed:!1,internalType:"address",name:"_seller",type:"address"},{indexed:!1,internalType:"bytes32",name:"_secretHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"withdrawnAt",type:"uint256"}],name:"Withdraw",type:"event"},{constant:!0,inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"swaps",outputs:[{internalType:"address",name:"token",type:"address"},{internalType:"addresspayable",name:"targetWallet",type:"address"},{internalType:"bytes32",name:"secret",type:"bytes32"},{internalType:"bytes32",name:"secretHash",type:"bytes32"},{internalType:"uint256",name:"createdAt",type:"uint256"},{internalType:"uint256",name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secretHash",type:"bytes32"},{internalType:"addresspayable",name:"_participantAddress",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"},{internalType:"address",name:"_token",type:"address"}],name:"createSwap",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secretHash",type:"bytes32"},{internalType:"addresspayable",name:"_participantAddress",type:"address"},{internalType:"addresspayable",name:"_targetWallet",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"},{internalType:"address",name:"_token",type:"address"}],name:"createSwapTarget",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_ownerAddress",type:"address"}],name:"getBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"tokenOwnerAddress",type:"address"}],name:"getTargetWallet",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secret",type:"bytes32"},{internalType:"address",name:"_ownerAddress",type:"address"}],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secret",type:"bytes32"},{internalType:"address",name:"participantAddress",type:"address"}],name:"withdrawNoMoney",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"bytes32",name:"_secret",type:"bytes32"},{internalType:"address",name:"_ownerAddress",type:"address"},{internalType:"address",name:"participantAddress",type:"address"}],name:"withdrawOther",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_participantAddress",type:"address"}],name:"getSecret",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_participantAddress",type:"address"}],name:"refund",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}],ton_address:"",ton_abi:[]},a={USDT:{fullName:"Tether USDT",address:"0x5070C3eD94bF90868aF26b84cc6876a4137D9ECF",abi:[{inputs:[{internalType:"string",name:"_name",type:"string"},{internalType:"string",name:"_symbol",type:"string"},{internalType:"uint8",name:"_decimals",type:"uint8"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_owner",type:"address"},{indexed:!0,internalType:"address",name:"_spender",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_from",type:"address"},{indexed:!0,internalType:"address",name:"_to",type:"address"},{indexed:!1,internalType:"uint256",name:"_value",type:"uint256"}],name:"Transfer",type:"event"},{constant:!1,inputs:[],name:"acceptOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_newOwner",type:"address"}],name:"transferOwnership",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_from",type:"address"},{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_owner",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_currentValue",type:"uint256"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"approve_fixed",outputs:[{internalType:"bool",name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_spender",type:"address"},{internalType:"uint256",name:"_value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"success",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_owner",type:"address"},{internalType:"address",name:"_spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"remaining",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_amount",type:"uint256"}],name:"mint",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"address[]",name:"dests",type:"address[]"},{internalType:"uint256[]",name:"values",type:"uint256[]"}],name:"multimint",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"}],decimals:6}},s={isMainnet:!1,network:r,contracts:n,tokens:a};e.exports={testnet_config:s}},cf77:function(e,t,r){r("99af"),r("d3b7");var n=r("ded3"),a=r("d662"),s=function(e,t){var r="".concat(t.method.toUpperCase()," ").concat(t.endpoint);return new Promise((function(n,a){return e.end((function(e,s){var i,o=s.body;if(s||e?(!s||s.statusCode>=500)&&(i="We`re having technical issues at that moment. Please try again later"):i="Connection failed: ".concat(r),i)throw new Error(i);if(e)return t.onComplete(),a({resData:o,err:e,res:s});if(!o)try{o=JSON.parse(s.text)}catch(e){return a(e)}var u=t.modifyResult(o);n(u,s),t.onComplete()}))}))},i={sameOrigin:!1,modifyResult:function(e){return e},onComplete:function(){}},o=function(e){var t=n(n({},i),e),r=a[t.method](t.endpoint);t.timeout&&r.timeout(n({response:5e3,deadline:6e4},t.timeout)),t.query&&r.query(t.query),t.body&&r.send(t.body),t.sameOrigin&&r.withCredentials();var o=s(r,t);return o.abort=r.abort.bind(r),o},u=function(e){return function(t,r){return o(n(n({},r),{},{endpoint:t,method:e}))}};e.exports={get:u("get"),post:u("post"),patch:u("patch"),put:u("put"),delete:u("delete")}},dec0:function(e,t,r){r("d3b7"),r("25f0"),r("9577");var n=r("c973"),a=r("970b"),s=r("5bc3"),i=(r("e267"),r("6993"),r("a210")),o=i.BigInteger,u=function(){"use strict";function e(t,r){a(this,e),this.client=t,this.orderbook=r,this.TON_TX_RETRY=600,this.id=void 0}return s(e,[{key:"initId",value:function(){var e=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.id){e.next=6;break}return e.t0=this.orderbook,e.next=4,this.orderbook.generateSecret();case 4:e.t1=e.sent,this.id=e.t0.bytesToHex.call(e.t0,e.t1);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"storageId",value:function(){return this.id}},{key:"load",value:function(e){var t=localStorage.getItem(e);if(t){var r=JSON.parse(t);this.state=r||void 0,this.id=e}}},{key:"save",value:function(){if(this.id)return localStorage.setItem(this.id,JSON.stringify(this.state)),this.id}},{key:"getOrder",value:function(){return this.state}},{key:"createOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r,n,a,s,i,o,u,c){var d,p,l,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("createOrder",t,r,n,a,s,i,o,u,c),d="TON CRYSTAL"===t,p=d?this.orderbook.directTable[r]:this.orderbook.reversedTable[t],l="0x0",!d){e.next=13;break}return e.t0=this.orderbook,e.t1=this.orderbook,e.next=9,this.orderbook.generateSecret();case 9:e.t2=e.sent,e.t3=e.t1.bytesToHex.call(e.t1,e.t2),e.t4=e.t0.hexAlign.call(e.t0,e.t3,64),l="0x"+e.t4;case 13:return this.create(p,u,d,!1,l,void 0,u),this.seed=c,e.prev=15,e.next=18,this.orderbook.createOrder(t,r,n,a,s,i,o,l,this.seed);case 18:h=e.sent,this.state.tonCreateTxId=h?h.transaction_id:void 0,this.state.tonCreateTxTm=Math.floor(Date.now()/1e3),e.next=29;break;case 23:throw e.prev=23,e.t5=e["catch"](15),console.log("createOrder error:",e.t5),this.state.status="failed",this.save(),e.t5;case 29:return this.watch(),e.abrupt("return",!0);case 31:case"end":return e.stop()}}),e,this,[[15,23]])})));function t(t,r,n,a,s,i,o,u,c){return e.apply(this,arguments)}return t}()},{key:"confirmOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(t,r,n,a,s){var i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("confirmOrder",t,r,n,a,s),i="0x0",t.direct){e.next=11;break}return e.t0=this.orderbook,e.t1=this.orderbook,e.next=7,this.orderbook.generateSecret();case 7:e.t2=e.sent,e.t3=e.t1.bytesToHex.call(e.t1,e.t2),e.t4=e.t0.hexAlign.call(e.t0,e.t3,64),i="0x"+e.t4;case 11:return this.create(t.swapId,t.id,t.direct,!0,i,t,a),this.seed=s,e.prev=13,e.next=16,this.orderbook.confirmOrder(t,r,n,i,this.seed);case 16:o=e.sent,this.state.tonConfirmTxId=o?o.transaction_id:void 0,this.state.tonConfirmTxTm=Math.floor(Date.now()/1e3),e.next=27;break;case 21:throw e.prev=21,e.t5=e["catch"](13),console.log("confirmOrder error:",e.t5),this.state.status="failed",this.save(),e.t5;case 27:return this.watch(),e.abrupt("return",!0);case 29:case"end":return e.stop()}}),e,this,[[13,21]])})));function t(t,r,n,a,s){return e.apply(this,arguments)}return t}()},{key:"create",value:function(e,t,r,n,a,s,i){this.state={status:void 0!==s?"confirming":"initiated",swapId:e,id:t,address:i,direct:r,confirm:n,secret:a,order:s,created:Math.floor(Date.now()/1e3)},this.save()}},{key:"isActive",value:function(){return void 0!==this.state&&!("closed"===this.state.status||"failed"===this.state.status)}},{key:"watch",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isActive()){e.next=104;break}if(t=this.state.status,r=!1,this.state.confirm){e.next=55;break}if(!this.state.direct){e.next=26;break}e.t0=this.state.status,e.next="initiated"===e.t0?8:"created"===e.t0?12:"confirmed"===e.t0?16:"return"===e.t0?20:24;break;case 8:return e.next=10,this.checkCreated();case 10:return r=e.sent,e.abrupt("break",24);case 12:return e.next=14,this.checkConfirm();case 14:return r=e.sent,e.abrupt("break",24);case 16:return e.next=18,this.withdrawAltSecret();case 18:return r=e.sent,e.abrupt("break",24);case 20:return e.next=22,this.withdrawTonTimeout();case 22:return r=e.sent,e.abrupt("break",24);case 24:e.next=53;break;case 26:e.t1=this.state.status,e.next="initiated"===e.t1?29:"created"===e.t1?33:"confirmed"===e.t1?37:"waitsecret"===e.t1?41:"withdrawTon"===e.t1?45:"withdrawAlt"===e.t1?49:53;break;case 29:return e.next=31,this.checkCreated();case 31:return r=e.sent,e.abrupt("break",53);case 33:return e.next=35,this.checkConfirm();case 35:return r=e.sent,e.abrupt("break",53);case 37:return e.next=39,this.createAltSwap();case 39:return r=e.sent,e.abrupt("break",53);case 41:return e.next=43,this.waitForSecret();case 43:return r=e.sent,e.abrupt("break",53);case 45:return e.next=47,this.withdrawTonSecret();case 47:return r=e.sent,e.abrupt("break",53);case 49:return e.next=51,this.withdrawAltTimeout();case 51:return r=e.sent,e.abrupt("break",53);case 53:e.next=96;break;case 55:if(!this.state.direct){e.next=81;break}e.t2=this.state.status,e.next="created"===e.t2||"confirming"===e.t2?59:"confirmed"===e.t2?63:"waitsecret"===e.t2?67:"withdrawTon"===e.t2?71:"withdrawAlt"===e.t2?75:79;break;case 59:return e.next=61,this.checkConfirm();case 61:return r=e.sent,e.abrupt("break",79);case 63:return e.next=65,this.createAltSwap();case 65:return r=e.sent,e.abrupt("break",79);case 67:return e.next=69,this.waitForSecret();case 69:return r=e.sent,e.abrupt("break",79);case 71:return e.next=73,this.withdrawTonSecret();case 73:return r=e.sent,e.abrupt("break",79);case 75:return e.next=77,this.withdrawAltTimeout();case 77:return r=e.sent,e.abrupt("break",79);case 79:e.next=96;break;case 81:e.t3=this.state.status,e.next="created"===e.t3||"confirming"===e.t3?84:"confirmed"===e.t3?88:"return"===e.t3?92:96;break;case 84:return e.next=86,this.checkConfirm();case 86:return r=e.sent,e.abrupt("break",96);case 88:return e.next=90,this.withdrawAltSecret();case 90:return r=e.sent,e.abrupt("break",96);case 92:return e.next=94,this.withdrawTonTimeout();case 94:return r=e.sent,e.abrupt("break",96);case 96:if(!r){e.next=100;break}return console.log("Order state changed:",this.id,t+" -> "+this.state.status),this.save(),e.abrupt("continue",0);case 100:return e.next=102,new Promise((function(e){return setTimeout(e,2e4)}));case 102:e.next=0;break;case 104:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkCreated",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("initiated"!==this.state.status&&console.warn("checkCreated: Incorrect state:",this.state.status),t=Math.floor(Date.now()/1e3),!(t>this.state.created+600)){e.next=5;break}return this.state.status="failed",e.abrupt("return",!0);case 5:if(e.prev=5,!this.state.direct){e.next=12;break}return e.next=9,this.orderbook.getDirectOrder(this.state.swapId,this.state.id);case 9:r=e.sent,e.next=15;break;case 12:return e.next=14,this.orderbook.getReversedOrder(this.state.swapId,this.state.id);case 14:r=e.sent;case 15:if(void 0!==r){e.next=17;break}return e.abrupt("return",!1);case 17:return this.state.order=r,this.state.status="created",e.abrupt("return",!0);case 22:e.prev=22,e.t0=e["catch"](5),console.log("checkCreated error:",e.t0);case 25:return e.abrupt("return",!1);case 26:case"end":return e.stop()}}),e,this,[[5,22]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkConfirm",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("created"!==this.state.status&&"confirming"!==this.state.status&&console.warn("checkConfirm: Incorrect state:",this.state.status),e.prev=1,!this.state.direct){e.next=8;break}return e.next=5,this.orderbook.getDirectOrder(this.state.swapId,this.state.id);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,this.orderbook.getReversedOrder(this.state.swapId,this.state.id);case 10:t=e.sent;case 11:if(void 0!==t){e.next=15;break}return this.state.confirm?this.state.status="failed":this.state.status="closed",console.log("order not found, go to",this.state.status),e.abrupt("return",!0);case 15:if(t.confirmed){e.next=17;break}return e.abrupt("return",!1);case 17:if(!t.direct){e.next=24;break}if(!this.state.confirm||t.confirmatorTargetAddress==this.state.address){e.next=22;break}return console.log("go to failed because",t.confirmatorTargetAddress,"expected to be",this.state.address),this.state.status="failed",e.abrupt("return",!0);case 22:e.next=28;break;case 24:if(!this.state.confirm||t.confirmatorSourceAddress==this.state.address){e.next=28;break}return console.log("go to failed because",t.confirmatorSourceAddress,"expected to be",this.state.address),this.state.status="failed",e.abrupt("return",!0);case 28:return this.state.order=t,this.state.confirmedTm=o(t.confirmTime).toJSValue(),this.state.altCreateUntil=o(t.confirmTime).toJSValue()+o(t.timeLockSlot).toJSValue(),this.state.altWithdrawUntil=o(t.confirmTime).toJSValue()+2*o(t.timeLockSlot).toJSValue(),this.state.tonWithdrawUntil=o(t.confirmTime).toJSValue()+3*o(t.timeLockSlot).toJSValue(),this.state.status="confirmed",console.log("found confirmed order, go to",this.state.status),e.abrupt("return",!0);case 38:e.prev=38,e.t0=e["catch"](1),console.log("checkConfirm error:",e.t0);case 41:return e.abrupt("return",!1);case 42:case"end":return e.stop()}}),e,this,[[1,38]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"withdrawAltSecret",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n,a,s,i,u,c,d,p,l,h,f,m,w,b,g,v,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("confirmed"!==this.state.status&&console.warn("withdrawAltSecret: Incorrect state:",this.state.status),t=Math.floor(Date.now()/1e3),!(t>this.state.altWithdrawUntil-900)){e.next=5;break}return this.state.status="return",e.abrupt("return",!0);case 5:return r=this.state.order.direct?this.state.order.toToken:this.state.order.fromToken,e.next=8,this.orderbook.getAltValue(this.state.order.value,this.state.order.exchangeRate);case 8:if(n=e.sent,void 0!==n){e.next=12;break}return this.state.status="return",e.abrupt("return",!0);case 12:if(a=this.state.order.secretHash,s=o(this.state.order.confirmTime).toJSValue()+2*o(this.state.order.timeLockSlot).toJSValue(),this.state.direct?(i=this.state.order.confirmatorSourceAddress,u=this.state.order.initiatorTargetAddress):(i=this.state.order.initiatorSourceAddress,u=this.state.order.confirmatorTargetAddress),e.prev=15,console.log("Start "+r+" check & withdraw with secret",this.state.secret,"srcAddress",i,"dstAddress",u,"altValue",n,"secretHash",a,"until",s),"ETH"!==r){e.next=46;break}return void 0===this.receiverEth&&(this.receiverEth=new this.orderbook.swappers.ETH.EthSwapReceiver(i,u,this.state.secret,a)),e.next=21,this.receiverEth.getSwap();case 21:if(c=e.sent,d="0x"+o(c.balance,10).toString(16),p=c.targetWallet,l=o(c.targetWallet,10),h=c.secretHash,0===o(u).compare(p)){e.next=29;break}return console.log("invalid dstAddress, got",p,"expected",u),e.abrupt("return",!1);case 29:if(0===o(a).compare(h)){e.next=32;break}return console.log("invalid secretHash, got",h,"expected",a),e.abrupt("return",!1);case 32:if(0===o(d).compare(n)){e.next=35;break}return console.log("invalid amount, got",d,"expected",n),e.abrupt("return",!1);case 35:if(!(t>l+3600-1200||l+3600<this.state.altWithdrawUntil)){e.next=38;break}return console.log("have no time",l,"now",t),e.abrupt("return",!1);case 38:return e.next=40,this.receiverEth.withdraw();case 40:return this.state.altFinishTxId=e.sent,this.state.altFinishTxTm=Math.floor(Date.now()/1e3),this.state.status="return",e.abrupt("return",!0);case 46:if("USDT"!==r){e.next=78;break}return void 0===this.receiverEth&&(this.receiverEth=new this.orderbook.swappers.USDT.EthTokenSwapReceiver("USDT",i,u,this.state.secret,a)),e.next=50,this.receiverEth.getSwap();case 50:if(f=e.sent,m="0x"+o(f.balance,10).toString(16),w=f.targetWallet,b=o(f.targetWallet,10),g=f.secretHash,v=this.receiverEth.tokenAddress,y=f.token,0===o(u).compare(w)){e.next=60;break}return console.log("invalid dstAddress, got",w,"expected",u),e.abrupt("return",!1);case 60:if(0===o(a).compare(g)){e.next=63;break}return console.log("invalid secretHash, got",g,"expected",a),e.abrupt("return",!1);case 63:if(0===o(m).compare(n)){e.next=66;break}return console.log("invalid amount, got",m,"expected",n),e.abrupt("return",!1);case 66:if(0===o(v).compare(y)){e.next=69;break}return console.log("invalid token, got",y,"expected",v),e.abrupt("return",!1);case 69:if(!(t>b+3600-1200||b+3600<this.state.altWithdrawUntil)){e.next=72;break}return console.log("have no time",b,"now",t),e.abrupt("return",!1);case 72:return e.next=74,this.receiverEth.withdraw();case 74:return this.state.altFinishTxId=e.sent,this.state.altFinishTxTm=Math.floor(Date.now()/1e3),this.state.status="return",e.abrupt("return",!0);case 78:e.next=83;break;case 80:e.prev=80,e.t0=e["catch"](15),console.log("withdrawAltSecret error:",e.t0);case 83:return e.abrupt("return",!1);case 84:case"end":return e.stop()}}),e,this,[[15,80]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"createAltSwap",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n,a,s,i,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("confirmed"!==this.state.status&&console.warn("createAltSwap: Incorrect state:",this.state.status),t=Math.floor(Date.now()/1e3),!(t>this.state.altCreateUntil-900)){e.next=5;break}return this.state.status="failed",e.abrupt("return",!0);case 5:return r=this.state.order.direct?this.state.order.toToken:this.state.order.fromToken,e.next=8,this.orderbook.getAltValue(this.state.order.value,this.state.order.exchangeRate);case 8:if(n=e.sent,void 0!==n){e.next=12;break}return this.state.status="failed",e.abrupt("return",!0);case 12:if(a=this.state.order.secretHash,s=o(this.state.order.confirmTime).toJSValue()+2*o(this.state.order.timeLockSlot).toJSValue(),this.state.direct?(i=this.state.order.confirmatorSourceAddress,u=this.state.order.initiatorTargetAddress):(i=this.state.order.initiatorSourceAddress,u=this.state.order.confirmatorTargetAddress),e.prev=15,console.log("Start "+r+" swap init with secret hash",a,"srcAddress",i,"dstAddress",u,"altValue",n,"until",s),"ETH"!==r){e.next=27;break}return void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.ETH.EthSwapInitiator(i,u,a)),e.next=21,this.initiatorEth.create(n);case 21:return this.state.altTxId=e.sent,this.state.altTxTm=Math.floor(Date.now()/1e3),this.state.status="waitsecret",e.abrupt("return",!0);case 27:if("USDT"!==r){e.next=49;break}if(void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.USDT.EthTokenSwapInitiator("USDT",i,u,a)),void 0!==this.state.altApproveTxId){e.next=37;break}return e.next=32,this.initiatorEth.approve(n);case 32:return this.state.altApproveTxId=e.sent,this.state.altApproveTxTm=Math.floor(Date.now()/1e3),e.abrupt("return",!0);case 37:return e.next=39,this.initiatorEth.checkApprove();case 39:if(c=e.sent,0===o(c).compare(n)){e.next=43;break}return console.log("Approve",c,"expected",n),e.abrupt("return",!1);case 43:return e.next=45,this.initiatorEth.create(n);case 45:return this.state.altTxId=e.sent,this.state.altTxTm=Math.floor(Date.now()/1e3),this.state.status="waitsecret",e.abrupt("return",!0);case 49:return e.abrupt("return",!1);case 52:return e.prev=52,e.t0=e["catch"](15),console.log("createAltSwap error:",e.t0),e.abrupt("return",!1);case 56:return e.abrupt("return",!1);case 57:case"end":return e.stop()}}),e,this,[[15,52]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"waitForSecret",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n,a,s,i,u,c,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("waitsecret"!==this.state.status&&console.warn("waitForSecret: Incorrect state",this.state.status),t=Math.floor(Date.now()/1e3),!(t>this.state.altWithdrawUntil+60)){e.next=5;break}return this.state.status="withdrawAlt",e.abrupt("return",!0);case 5:if(r=this.state.order.direct?this.state.order.toToken:this.state.order.fromToken,n=this.state.order.secretHash,this.state.direct?(a=this.state.order.confirmatorSourceAddress,s=this.state.order.initiatorTargetAddress):(a=this.state.order.initiatorSourceAddress,s=this.state.order.confirmatorTargetAddress),e.prev=8,console.log("Start request secret from ",r,"srcAddress",a,"dstAddress",s,"secretHash",n),"ETH"!==r){e.next=25;break}return void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.ETH.EthSwapInitiator(a,s,n)),e.next=14,this.initiatorEth.getSwap();case 14:if(i=e.sent,void 0!==i){e.next=17;break}return e.abrupt("return",!1);case 17:if(u=i.secret,void 0!==u&&null!==u&&""!==u&&0!==o(u).compare(0)){e.next=20;break}return e.abrupt("return",!1);case 20:return this.state.secret=u.toLowerCase(),this.state.status="withdrawTon",e.abrupt("return",!0);case 25:if("USDT"!==r){e.next=38;break}return void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.USDT.EthTokenSwapInitiator("USDT",a,s,n)),e.next=29,this.initiatorEth.getSwap();case 29:if(c=e.sent,void 0!==c){e.next=32;break}return e.abrupt("return",!1);case 32:if(d=c.secret,void 0!==d&&null!==d&&""!==d&&0!==o(d).compare(0)){e.next=35;break}return e.abrupt("return",!1);case 35:return this.state.secret=d.toLowerCase(),this.state.status="withdrawTon",e.abrupt("return",!0);case 38:return e.abrupt("return",!1);case 41:e.prev=41,e.t0=e["catch"](8),console.log("waitForSecret error:",e.t0);case 44:return e.abrupt("return",!1);case 45:case"end":return e.stop()}}),e,this,[[8,41]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"withdrawAltTimeout",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n,a,s,i,u,c,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("withdrawAlt"!==this.state.status&&console.warn("withdrawAltTimeout: Incorrect state",this.state.status),t=Math.floor(Date.now()/1e3),r=this.state.order.direct?this.state.order.toToken:this.state.order.fromToken,n=this.state.order.secretHash,this.state.direct?(a=this.state.order.confirmatorSourceAddress,s=this.state.order.initiatorTargetAddress):(a=this.state.order.initiatorSourceAddress,s=this.state.order.confirmatorTargetAddress),void 0!==this.state.altFinishTxId){e.next=34;break}if(e.prev=6,console.log("Start withdraw timeout from ",r,"srcAddress",a,"dstAddress",s,"secretHash",n,"lockUntil",this.state.altWithdrawUntil,"now",t),"ETH"!==r){e.next=19;break}return void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.ETH.EthSwapInitiator(a,s,n)),e.next=12,this.initiatorEth.withdrawWithTimeout();case 12:if(i=e.sent,void 0===i){e.next=17;break}return this.state.altFinishTxId=i,this.state.altFinishTxTm=Math.floor(Date.now()/1e3),e.abrupt("return",!0);case 17:e.next=28;break;case 19:if("USDT"!==r){e.next=28;break}return void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.USDT.EthTokenSwapInitiator("USDT",a,s,n)),e.next=23,this.initiatorEth.withdrawWithTimeout();case 23:if(u=e.sent,void 0===u){e.next=28;break}return this.state.altFinishTxId=u,this.state.altFinishTxTm=Math.floor(Date.now()/1e3),e.abrupt("return",!0);case 28:return e.abrupt("return",!1);case 31:e.prev=31,e.t0=e["catch"](6),console.log("withdrawAltTimeout error:",e.t0);case 34:if(e.prev=34,console.log("Start request state from ",r,"srcAddress",a,"dstAddress",s,"secretHash",n),void 0,"ETH"!==r){e.next=54;break}return void 0===this.initiatorEth&&(this.initiatorEth=new this.orderbook.swappers.ETH.EthSwapInitiator(a,s,n)),e.next=41,this.initiatorEth.getSwap();case 41:if(c=e.sent,void 0!==c){e.next=44;break}return e.abrupt("return",!1);case 44:if(d=c.secret,p=o(c.balance,10),0!==p.compare(0)){e.next=49;break}return this.state.status="failed",e.abrupt("return",!0);case 49:if(void 0!==d&&null!==d&&""!==d&&0!==o(d).compare(0)){e.next=51;break}return e.abrupt("return",!1);case 51:return this.state.secret=d.toLowerCase(),this.state.status="withdrawTon",e.abrupt("return",!0);case 54:e.next=59;break;case 56:e.prev=56,e.t1=e["catch"](34),console.log("withdrawAltTimeout error:",e.t1);case 59:return e.abrupt("return",!1);case 60:case"end":return e.stop()}}),e,this,[[6,31],[34,56]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"withdrawTonSecret",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("withdrawTon"!==this.state.status&&console.warn("withdrawTonSecret: Incorrect state",this.state.status),t=Math.floor(Date.now()/1e3),!(void 0===this.state.tonFinishTxId||t>this.state.tonFinishTxTm+this.TON_TX_RETRY)){e.next=15;break}return e.prev=3,e.next=6,this.orderbook.finishOrderWithSecret(this.state.order,this.state.secret,this.seed);case 6:return r=e.sent,this.state.tonFinishTxId=r?r.transaction_id:void 0,this.state.tonFinishTxTm=Math.floor(Date.now()/1e3),e.abrupt("return",!0);case 12:e.prev=12,e.t0=e["catch"](3),console.log("finishOrderWithSecret error:",e.t0);case 15:if(e.prev=15,!this.state.direct){e.next=22;break}return e.next=19,this.orderbook.getDirectOrder(this.state.swapId,this.state.id);case 19:n=e.sent,e.next=25;break;case 22:return e.next=24,this.orderbook.getReversedOrder(this.state.swapId,this.state.id);case 24:n=e.sent;case 25:if(void 0!==n){e.next=28;break}return this.state.status="closed",e.abrupt("return",!0);case 28:e.next=33;break;case 30:e.prev=30,e.t1=e["catch"](15),console.log("withdrawTonSecret error:",e.t1);case 33:return e.abrupt("return",!1);case 34:case"end":return e.stop()}}),e,this,[[3,12],[15,30]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"withdrawTonTimeout",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("return"!==this.state.status&&console.warn("withdrawTonTimeout: Incorrect state",this.state.status),t=Math.floor(Date.now()/1e3),!(t>this.state.tonWithdrawUntil+60)){e.next=16;break}if(!(void 0===this.state.tonFinishTxId||t>this.state.tonFinishTxTm+this.TON_TX_RETRY)){e.next=16;break}return e.prev=4,e.next=7,this.orderbook.finishOrderWithTimeout(this.state.order,this.seed);case 7:return r=e.sent,this.state.tonFinishTxId=r?r.transaction_id:void 0,this.state.tonFinishTxTm=Math.floor(Date.now()/1e3),e.abrupt("return",!0);case 13:e.prev=13,e.t0=e["catch"](4),console.log("finishOrderWithTimeout error:",e.t0);case 16:if(e.prev=16,!this.state.direct){e.next=23;break}return e.next=20,this.orderbook.getDirectOrder(this.state.swapId,this.state.id);case 20:n=e.sent,e.next=26;break;case 23:return e.next=25,this.orderbook.getReversedOrder(this.state.swapId,this.state.id);case 25:n=e.sent;case 26:if(void 0!==n){e.next=29;break}return this.state.status="closed",e.abrupt("return",!0);case 29:e.next=34;break;case 31:e.prev=31,e.t1=e["catch"](16),console.log("getOrder error:",e.t1);case 34:return e.abrupt("return",!1);case 35:case"end":return e.stop()}}),e,this,[[4,13],[16,31]])})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),c=function(){"use strict";function e(t,r){a(this,e),this.client=t,this.orderbook=r,this.orders=[],this.inited=!1}return s(e,[{key:"isInited",value:function(){return this.inited}},{key:"init",value:function(e,t){this.address=e,this.seed=t,this.loadAll(),this.inited=!0}},{key:"loadAll",value:function(){var e=localStorage.getItem("orderList_"+this.address);if(e)for(var t in e=JSON.parse(e),e){var r=new u(this.client,this.orderbook);r.load(e[t]),void 0!==r.state&&(r.isActive()&&(r.seed=this.seed,r.watch()),this.orders.push(r))}}},{key:"saveAll",value:function(){var e=[];for(var t in this.orders){var r=this.orders[t];r.storageId()&&e.push(r.storageId())}localStorage.setItem("orderList_"+this.address,JSON.stringify(e))}},{key:"newOrder",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new u(this.client,this.orderbook),e.next=3,t.initId();case 3:return this.orders.push(t),this.saveAll(),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isAnyActive",value:function(){for(var e in this.orders){var t=this.orders[e];if(t.isActive())return!0}return!1}},{key:"getOrders",value:function(){var e=[];for(var t in this.orders){var r=this.orders[t];e.push(r.getOrder())}return e}}]),e}();e.exports=c},e267:function(e,t){var r={"ABI version":2,header:["time"],functions:[{name:"constructor",inputs:[{name:"ethSmcAddress",type:"uint256"},{name:"ethTokenSmcAddress",type:"uint256"}],outputs:[]},{name:"withdraw",inputs:[{name:"amount",type:"uint256"}],outputs:[]},{name:"getBalance",inputs:[{name:"participant",type:"address"}],outputs:[{components:[{name:"value",type:"uint256"},{name:"inOrders",type:"uint256"},{name:"locked",type:"uint256"}],name:"balance",type:"tuple"}]},{name:"getEthSmcAddress",inputs:[],outputs:[{name:"ethSmcAddress",type:"uint256"}]},{name:"getEthTokenSmcAddress",inputs:[],outputs:[{name:"ethTokenSmcAddress",type:"uint256"}]},{name:"createDirectOrder",inputs:[{name:"dbId",type:"uint32"},{name:"value",type:"uint256"},{name:"minValue",type:"uint256"},{name:"exchangeRate",type:"uint256"},{name:"timeLockSlot",type:"uint32"},{name:"secretHash",type:"uint256"},{name:"initiatorTargetAddress",type:"uint256"}],outputs:[]},{name:"deleteDirectOrder",inputs:[{name:"dbId",type:"uint32"}],outputs:[]},{name:"confirmDirectOrder",inputs:[{name:"dbId",type:"uint32"},{name:"value",type:"uint256"},{name:"initiatorAddress",type:"address"},{name:"confirmatorSourceAddress",type:"uint256"}],outputs:[]},{name:"finishDirectOrderWithSecret",inputs:[{name:"dbId",type:"uint32"},{name:"initiatorAddress",type:"address"},{name:"secret",type:"bytes"}],outputs:[]},{name:"finishDirectOrderWithTimeout",inputs:[{name:"dbId",type:"uint32"},{name:"initiatorAddress",type:"address"}],outputs:[]},{name:"createReversedOrder",inputs:[{name:"dbId",type:"uint32"},{name:"value",type:"uint256"},{name:"minValue",type:"uint256"},{name:"exchangeRate",type:"uint256"},{name:"timeLockSlot",type:"uint32"},{name:"initiatorSourceAddress",type:"uint256"}],outputs:[]},{name:"deleteReversedOrder",inputs:[{name:"dbId",type:"uint32"}],outputs:[]},{name:"confirmReversedOrder",inputs:[{name:"dbId",type:"uint32"},{name:"value",type:"uint256"},{name:"initiatorAddress",type:"address"},{name:"confirmatorTargetAddress",type:"uint256"},{name:"secretHash",type:"uint256"}],outputs:[]},{name:"finishReversedOrderWithSecret",inputs:[{name:"dbId",type:"uint32"},{name:"initiatorAddress",type:"address"},{name:"secret",type:"bytes"}],outputs:[]},{name:"finishReversedOrderWithTimeout",inputs:[{name:"dbId",type:"uint32"},{name:"initiatorAddress",type:"address"}],outputs:[]},{name:"calcForeignOutput",inputs:[{name:"value",type:"uint256"},{name:"exchangeRate",type:"uint256"}],outputs:[{name:"foreignValue",type:"uint256"}]},{name:"getDirectOrders",inputs:[{name:"dbId",type:"uint32"}],outputs:[{name:"orders",type:"address[]"}]},{name:"getReversedOrders",inputs:[{name:"dbId",type:"uint32"}],outputs:[{name:"orders",type:"address[]"}]},{name:"getDirectOrder",inputs:[{name:"dbId",type:"uint32"},{name:"initiatorAddress",type:"address"}],outputs:[{components:[{name:"confirmed",type:"bool"},{name:"confirmTime",type:"uint32"},{name:"value",type:"uint256"},{name:"minValue",type:"uint256"},{name:"exchangeRate",type:"uint256"},{name:"timeLockSlot",type:"uint32"},{name:"secretHash",type:"uint256"},{name:"initiatorTargetAddress",type:"uint256"},{name:"confirmatorTargetAddress",type:"address"},{name:"confirmatorSourceAddress",type:"uint256"}],name:"order",type:"tuple"}]},{name:"getReversedOrder",inputs:[{name:"dbId",type:"uint32"},{name:"initiatorAddress",type:"address"}],outputs:[{components:[{name:"confirmed",type:"bool"},{name:"confirmTime",type:"uint32"},{name:"foreignValue",type:"uint256"},{name:"foreignMinValue",type:"uint256"},{name:"exchangeRate",type:"uint256"},{name:"timeLockSlot",type:"uint32"},{name:"initiatorSourceAddress",type:"uint256"},{name:"value",type:"uint256"},{name:"confirmatorSourceAddress",type:"address"},{name:"confirmatorTargetAddress",type:"uint256"},{name:"secretHash",type:"uint256"}],name:"order",type:"tuple"}]},{name:"getHash",inputs:[{name:"secret",type:"bytes"}],outputs:[{name:"hash",type:"uint256"}]}],data:[],events:[]};e.exports=r},e3ba:function(e,t,r){r("99af"),r("b0c0"),r("d3b7"),r("25f0"),r("9577");var n=r("c973"),a=r("970b"),s=r("5bc3"),i=r("cf77"),o=r("e8d6"),u=r("57f2"),c="https://rinkeby.infura.io/JCnK5ifEPH9qcQkX0Ahl",d=Object({NODE_ENV:"production",BASE_URL:"/"}).WEB3_MAINNET_PROVIDER||"https://geth.swaponline.site",p=Object({NODE_ENV:"production",BASE_URL:"/"}).WEB3_LOCAL_PROVIDER||"http://localhost:7545",l={mainnet:new u.providers.HttpProvider(d),testnet:new u.providers.HttpProvider(c),localnet:new u.providers.HttpProvider(p)},h="https://www.etherchain.org/api/gasPriceOracle",f="https://ethgasstation.info/json/ethgasAPI.json",m=r("7876"),w=new m(10),b="F5HISS9Z7CKKWHQAGC9ZFS8I8B28B3FI3U",g=function(e){e.name,e.code;var t=e.statusCode;e.options;throw o("swap.core:ethereum")("UnknownError: statusCode=".concat(t," ").concat(e.message)),e},v=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"testnet";a(this,e);var r=l[t];"undefined"!==typeof web3?this.core=new u(web3.currentProvider):this.core=new u(r),this.etherscan="testnet"===t?"https://ropsten.etherscan.io":"https://api.etherscan.io"}return s(e,[{key:"fetchBalance",value:function(e){var t=this;return this.core.eth.getBalance(e).then((function(e){var r=t.core.utils.fromWei(e);return o("swap.core:ethereum")("ETH Balance:",r),r})).catch((function(e){return o("swap.core:ethereum")("ETH error:",e),"0"}))}},{key:"fetchTokenBalance",value:function(e,t,r){var n=w.pow(r),a="".concat(this.etherscan,"/api?module=account&action=tokenbalance&contractaddress=").concat(t,"&address=").concat(e,"&apikey=").concat(b);return i.get(a,{cacheResponse:1e4,queryResponse:!0}).then((function(e){var t=e.result;return t})).then((function(e){return m(e).dividedBy(n).toString()})).catch((function(e){return o("swap.core:ethereum")("TokenBalanceError: ".concat(e.statusCode," ").concat(a," - Failed to fetch token balance (").concat(t,"). Probably too frequent request!")),"0"}))}},{key:"sendTransaction",value:function(){var e=n(regeneratorRuntime.mark((function e(t){var r,n,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.to,n=t.value,a=this.core.eth.accounts.wallet[0],s=1e5,n=this.core.utils.toWei(n.toString()),e.abrupt("return",this.core.eth.sendTransaction({from:a,to:r,value:n,gas:s}));case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"estimateGasPrice",value:function(){var e=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.estimateGasPriceEtherChain(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e["catch"](0),console.error("EstimateFeeError: EtherChain, falling back to EthGasStation estimation...",e.t0);case 9:return e.prev=9,e.next=12,this.estimateGasPriceEthGasStation(t);case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t1=e["catch"](9),console.error("EstimateFeeError: EthGasStation, falling back to Web3 estimation...",e.t1);case 18:return e.next=20,this.estimateGasPriceWeb3(t);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this,[[0,6],[9,15]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"estimateGasPriceWeb3",value:function(){var e=n(regeneratorRuntime.mark((function e(){var t,r,n,a,s,i=this,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},r=t.speed,n=void 0===r?"fast":r,a=function(){switch(n){case"fast":return 2;case"normal":return 1;case"slow":return.5;default:return 1}}(),e.next=4,new Promise((function(e,t){return i.core.eth.getGasPrice((function(r,n){r?t(r):e(n)}))}));case 4:return s=e.sent,e.abrupt("return",m(s).multipliedBy(a));case 6:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"estimateGasPriceEtherChain",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speed,r=void 0===t?"fast":t,n=function(){switch(r){case"fast":return"fast";case"normal":return"standard";case"slow":return"safeLow";default:return"standard"}}();return i.get("".concat(h),{cacheResponse:6e5,queryResponse:!0,cacheOnFail:!0}).then((function(e){return m(e[n]).multipliedBy(1e9)})).catch((function(e){return g(e)}))}},{key:"estimateGasPriceEthGasStation",value:function(e){var t=e.speed,r=void 0===t?"fast":t,n=function(){switch(r){case"fast":return"fast";case"normal":return"average";case"slow":return"safeLow";default:return"average"}}();return i.get("".concat(f),{cacheResponse:6e5,queryResponse:!0,cacheOnFail:!0}).then((function(e){return m(e[n]).dividedBy(10).multipliedBy(1e9)})).catch((function(e){return g(e)}))}}]),e}();e.exports=new v,e.exports.mainnet=function(){return new v("mainnet")},e.exports.testnet=function(){return new v("testnet")},e.exports.localnet=function(){return new v("localnet")}},e550:function(e,t,r){var n=r("29bb");"undefined"!==typeof window&&(window.TonSwapOrderbook=n),e.exports=n},e8d6:function(e,t){e.exports=function(e){return console.log(e),console.log}},fc3e:function(e,t,r){r("99af"),r("4de4"),r("fb6a"),r("b0c0"),r("d3b7"),r("ac1f"),r("25f0"),r("5319"),r("1276");var n=r("278c"),a=r("480f"),s=r("448a"),i=r("ded3");r("9577");var o=r("c973"),u=r("970b"),c=r("5bc3"),d=r("7876"),p=r("57f2"),l=r("af6c"),h=r("e8d6"),f=r("e3ba"),m=f.mainnet,w=f.testnet,b=function(){"use strict";function e(t){var r=this;if(u(this,e),!t.name)throw new Error('EthTokenSwap: "name" required');if("string"!==typeof t.address)throw new Error('EthTokenSwap: "address" required');if("number"!==typeof t.decimals)throw new Error('EthTokenSwap: "decimals" required');if(!Array.isArray(t.tokenAbi))throw new Error('EthTokenSwap: "abi" required');if("string"!==typeof t.tokenAddress)throw new Error('EthTokenSwap: "tokenAddress" required');if(!Array.isArray(t.tokenAbi))throw new Error('EthTokenSwap: "tokenAbi" required');if("function"!==typeof t.getParticipantAddress)throw new Error('EthTokenSwap: "getParticipantAddress" required');this._swapName=t.name.toUpperCase(),this.web3="undefined"!==typeof window&&window.web3?window.web3:new p(new p.providers.HttpProvider(t.provider)),this.ethereum=t.mainnet?m():w(),this.fetchBalance=function(e){return r.ethereum.fetchTokenBalance(e,t.tokenAddress,t.decimals)},this.estimateGasPrice=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.speed;return r.ethereum.estimateGasPrice({speed:t})},this.getParticipantAddress=t.getParticipantAddress,this.address=t.address,this.abi=t.abi,this.decimals=t.decimals,this.tokenAddress=t.tokenAddress.toLowerCase(),this.tokenAbi=t.tokenAbi,this.gasLimit=t.gasLimit||2e5,this.gasPrice=t.gasPrice||2e9,this.decoder=new l(this.abi),this.contract=new this.web3.eth.Contract(this.abi,this.address),this.ERC20=new this.web3.eth.Contract(this.tokenAbi,this.tokenAddress)}return c(e,[{key:"updateGas",value:function(){return console.warn("EthSwap.updateGas() is deprecated and will be removed. Use .updateGasPrice()"),this.updateGasPrice()}},{key:"updateGasPrice",value:function(){var e=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return h("gas price before update",this.gasPrice),e.prev=1,e.next=4,this.estimateGasPrice({speed:"fast"});case 4:this.gasPrice=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),h("EthTokenSwap: Error with gas update: ".concat(e.t0.message,", using old value gasPrice=").concat(this.gasPrice));case 10:h("gas price after update",this.gasPrice);case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"send",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,u=this,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3?c[3]:void 0,"function"===typeof this.contract.methods[t]){e.next=4;break}throw new Error("EthTokenSwap.send: No method ".concat(t," in contract"));case 4:return e.next=6,this.updateGasPrice();case 6:return e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(o,c){var p,l,h,f,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return h=i({from:u.getParticipantAddress(),gas:u.gasLimit,gasPrice:u.gasPrice},n),console.log("EthTokenSwap -> ".concat(t," -> params"),h),e.next=4,(p=u.contract.methods)[t].apply(p,s(r)).estimateGas(h);case 4:return f=e.sent,h.gas=f,console.log("EthTokenSwap -> ".concat(t," -> gas"),f),e.next=9,(l=u.contract.methods)[t].apply(l,s(r)).send(h).on("transactionHash",(function(e){"function"===typeof a&&a(e)})).catch((function(e){c({message:e.message,gasAmount:d(f).dividedBy(1e8).toString()})}));case 9:m=e.sent,o(m);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"approve",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.amount,a=n,e.next=4,this.updateGasPrice();case 4:return e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(t,n){var i,o,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,i={from:s.getParticipantAddress(),gas:s.gasLimit,gasPrice:s.gasPrice},h("EthTokenSwap -> approve -> params",i),e.next=5,s.ERC20.methods.approve(s.address,a).estimateGas(i);case 5:return o=e.sent,i.gas=o,h("EthTokenSwap -> approve -> gas",o),e.next=10,s.ERC20.methods.approve(s.address,a).send(i).on("transactionHash",(function(e){"function"===typeof r&&r(e)})).catch((function(e){n({message:e.message,gasAmount:d(o).dividedBy(1e8).toString()})}));case 10:u=e.sent,t(u),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r){return e.apply(this,arguments)}}()));case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"checkAllowance",value:function(e){var t=this,r=e.spender;return new Promise(function(){var e=o(regeneratorRuntime.mark((function e(n,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.ERC20.methods.allowance(r,t.address).call({from:t.getParticipantAddress()});case 3:s=e.sent,n(s),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),a(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"create",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.targetWallet||t.targetWallet===t.participantAddress){e.next=4;break}return e.abrupt("return",this.createSwapTarget(t,r));case 4:return e.abrupt("return",this.createSwap(t,r));case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSwap",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s,i,o,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.secretHash,a=t.participantAddress,s=t.amount,i=s,o="0x".concat(n.replace(/^0x/,"")),u=[o,a,i,this.tokenAddress],console.log("createSwap args:",u),e.abrupt("return",this.send("createSwap",[].concat(u),{},r));case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"createSwapTarget",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s,i,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.secretHash,a=t.participantAddress,s=t.amount,i=t.targetWallet,o=s,u="0x".concat(n.replace(/^0x/,"")),c=[u,a,i,o,this.tokenAddress],e.abrupt("return",this.send("createSwapTarget",[].concat(c),{},r));case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"swaps",value:function(e){var t=e.ownerAddress,r=e.participantAddress;return this.contract.methods.swaps(t,r).call()}},{key:"checkSwapExists",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.swaps(t);case 2:return r=e.sent,h("swapExists",r),n=r&&r.balance?parseInt(r.balance):0,e.abrupt("return",n>0);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getBalance",value:function(e){var t=e.ownerAddress;return this.contract.methods.getBalance(t).call({from:this.getParticipantAddress()})}},{key:"checkBalance",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,a,s,i,o,u,c,p,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.ownerAddress,n=t.participantAddress,a=t.expectedValue,s=t.expectedHash,e.next=3,util.helpers.repeatAsyncUntilResult((function(){return l.getBalance({ownerAddress:r})}));case 3:return i=e.sent,e.next=6,util.helpers.repeatAsyncUntilResult((function(){return l.contract.methods.swaps(r,n).call()}));case 6:if(o=e.sent,u=o.secretHash,h("swap.core:swaps")("swap.secretHash",u),c="".concat(u.replace(/^0x/,"")),h("swap.core:swaps")("secretHash: expected hash = ".concat(s,", contract hash = ").concat(c)),s===c){e.next=13;break}return e.abrupt("return","Expected hash: ".concat(s,", got: ").concat(c));case 13:if(p=d(a).multipliedBy(this.decimals),!p.isGreaterThan(i)){e.next=16;break}return e.abrupt("return","Expected value: ".concat(p.toString(),", got: ").concat(i));case 16:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchSwapEvents",value:function(){var e=o(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this._allSwapEvents){e.next=2;break}return e.abrupt("return",this._allSwapEvents);case 2:return e.next=4,this.contract.getPastEvents("allEvents",{fromBlock:0,toBlock:"latest"});case 4:return t=e.sent,this.contract.events.allEvents({fromBlock:0,toBlock:"latest"}).on("data",(function(e){r._allSwapEvents.push(e)})).on("changed",(function(e){console.error("EthTokenSwap: fetchEvents: needs rescan"),r._allSwapEvents=null})).on("error",(function(e){console.error(e),r._allSwapEvents=null})),this._allSwapEvents=t,e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"findSwap",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,s,i,o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.secretHash,e.next=3,this.fetchSwapEvents();case 3:return n=e.sent,s=n.filter((function(e){var t=e.returnValues;return t._secretHash==="0x".concat(r.replace("0x",""))})),i=a(s),o=i[0],u=i[1],c=i.slice(2),c&&c.length&&console.error("More than two swaps with same hash",c),e.abrupt("return",[o,u]);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"wasClosed",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.findSwap(t);case 2:if(r=e.sent,a=n(r,2),s=a[0],i=a[1],s){e.next=11;break}return h("No swap with hash ".concat(t.secretHash)),e.abrupt("return","no swap");case 11:if(!s||i){e.next=16;break}return h("Open yet!"),e.abrupt("return","open");case 16:if("Withdraw"!=i.event){e.next=21;break}return h("Withdrawn"),e.abrupt("return","withdrawn");case 21:if("Refund"!=i.event){e.next=26;break}return h("Refund"),e.abrupt("return","refunded");case 26:return h("Unknown event, error"),e.abrupt("return","error");case 28:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"wasRefunded",value:function(e){return this.wasClosed(e).then((function(e){return"refunded"===e}))}},{key:"wasWithdrawn",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.wasClosed(t);case 2:return r=e.sent,e.abrupt("return","withdrawn"===r);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"checkTokenIsValid",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,a,s,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.ownerAddress,n=t.participantAddress,h("swap.core:swaps")("Check token is valid. Needed token address: ".concat(this.tokenAddress.toUpperCase())),e.next=4,util.helpers.repeatAsyncUntilResult((function(){return i.contract.methods.swaps(r,n).call()}));case 4:return a=e.sent,s=a.token,h("swap.core:swaps")("Token address at swap contract: ".concat(s.toUpperCase())),e.abrupt("return",this.tokenAddress.toUpperCase()==s.toUpperCase());case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"hasTargetWallet",value:function(){return!!this.contract.methods.getTargetWallet}},{key:"getTargetWallet",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,util.helpers.repeatAsyncUntilResult((function(){return n.getTargetWalletPromise(t)}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getTargetWalletPromise",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return h("swap.core:swaps")("EthTokenSwap->getTargetWallet"),e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(n,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.contract.methods.getTargetWallet(t).call({from:r.getParticipantAddress()});case 3:s=e.sent,h("swap.core:swaps")("EthTokenSwap->getTargetWallet",s),n(s),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),a(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"calcWithdrawGas",value:function(){var e=o(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.calcWithdrawOtherGas({ownerAddress:t.ownerAddress,participantAddress:this.getParticipantAddress(),secret:t.secret}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdraw",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.withdrawOther({ownerAddress:t.ownerAddress,participantAddress:this.getParticipantAddress(),secret:t.secret},r));case 1:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"calcWithdrawNoMoneyGas",value:function(){var e=o(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.calcWithdrawOtherGas({ownerAddress:this.getParticipantAddress(),participantAddress:t.participantAddress,secret:t.secret}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdrawNoMoney",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.withdrawOther({ownerAddress:this.getParticipantAddress(),participantAddress:t.participantAddress,secret:t.secret},r));case 1:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"calcWithdrawOtherGas",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,a,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.ownerAddress,n=t.participantAddress,a=t.secret,e.next=3,this.updateGasPrice();case 3:return e.abrupt("return",new Promise(function(){var e=o(regeneratorRuntime.mark((function e(t,i){var o,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o="0x".concat(a.replace(/^0x/,"")),u={from:s.getParticipantAddress(),gas:s.gasLimit,gasPrice:s.gasPrice},e.prev=2,e.next=5,s.contract.methods.withdrawOther(o,r,n).estimateGas(u);case 5:c=e.sent,t(c),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](2),i(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,r){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"withdrawOther",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.ownerAddress,a=t.participantAddress,s=t.secret,i="0x".concat(s.replace(/^0x/,"")),console.log("withdrawOther args",[i,n,a]),e.next=5,this.updateGasPrice();case 5:return e.abrupt("return",this.send("withdrawOther",[i,n,a],{},r));case 6:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"refund",value:function(){var e=o(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.participantAddress,e.next=3,this.updateGasPrice();case 3:return e.abrupt("return",this.send("refund",[n],{},r));case 4:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getSecret",value:function(e){var t=this,r=e.participantAddress;return new Promise(function(){var e=o(regeneratorRuntime.mark((function e(n,a){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.contract.methods.getSecret(r).call({from:t.getParticipantAddress()});case 3:s=e.sent,i=s&&!/^0x0+$/.test(s)?s:null,n(i),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),a(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,r){return e.apply(this,arguments)}}())}},{key:"getSecretFromTxhash",value:function(){var e=o(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.web3.eth.getTransaction(t).then((function(e){try{var t=r.decoder.decodeData(e.input);return r.web3.utils.bytesToHex(t.inputs[0]).split("0x")[1]}catch(n){return void h("swap.core:swaps")("Trying to fetch secret from tx: "+n.message)}})));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}();e.exports=b}});
//# sourceMappingURL=app.364b2511.js.map